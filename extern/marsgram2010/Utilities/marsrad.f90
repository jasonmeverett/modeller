      MODULE qrhtp_I                                                              !VAST  1
      INTERFACE                                                                   !VAST  2
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST  3
      REAL FUNCTION qrhtp (RH, T, P)                                              !VAST  4
      REAL, INTENT(IN) :: RH                                                      !VAST  5
      REAL, INTENT(IN) :: T                                                       !VAST  6
      REAL, INTENT(IN) :: P                                                       !VAST  7
      END FUNCTION                                                                !VAST  8
      END INTERFACE                                                               !VAST  9
      END MODULE                                                                  !VAST 10
!=============================================================================    !VAST 11
      MODULE emitt_I                                                              !VAST 12
      INTERFACE                                                                   !VAST 13
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 14
      REAL FUNCTION emitt (UW, UC, T)                                             !VAST 15
      real :: UW                                                                  !VAST 16
      real :: UC                                                                  !VAST 17
      real :: T                                                                   !VAST 18
!VAST...Calls: EPSILONC, EPSILONW                                                 !VAST 19
      END FUNCTION                                                                !VAST 20
      END INTERFACE                                                               !VAST 21
      END MODULE                                                                  !VAST 22
!============================================================================     !VAST 23
      MODULE epsilonc_I                                                           !VAST 24
      INTERFACE                                                                   !VAST 25
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 26
      REAL FUNCTION epsilonc (UC, T)                                              !VAST 27
      real, INTENT(IN) :: UC                                                      !VAST 28
      real, INTENT(IN) :: T                                                       !VAST 29
      END FUNCTION                                                                !VAST 30
      END INTERFACE                                                               !VAST 31
      END MODULE                                                                  !VAST 32
!============================================================================     !VAST 33
      MODULE epsilonw_I                                                           !VAST 34
      INTERFACE                                                                   !VAST 35
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 36
      REAL FUNCTION epsilonw (UW, T)                                              !VAST 37
      real, INTENT(IN) :: UW                                                      !VAST 38
      real, INTENT(IN) :: T                                                       !VAST 39
      END FUNCTION                                                                !VAST 40
      END INTERFACE                                                               !VAST 41
      END MODULE                                                                  !VAST 42
!============================================================================     !VAST 43
      MODULE epsdust_I                                                            !VAST 44
      INTERFACE                                                                   !VAST 45
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 46
      REAL FUNCTION epsdust (TAU)                                                 !VAST 47
      real, INTENT(IN) :: TAU                                                     !VAST 48
      END FUNCTION                                                                !VAST 49
      END INTERFACE                                                               !VAST 50
      END MODULE                                                                  !VAST 51
!============================================================================     !VAST 52
      MODULE delted_I                                                             !VAST 53
      INTERFACE                                                                   !VAST 54
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 55
      SUBROUTINE delted (G, OM, T, AMU0, RDIF, TDIF, RDIR, TDD, TBEAM)            !VAST 56
      REAL, INTENT(IN) :: G                                                       !VAST 57
      REAL, INTENT(IN) :: OM                                                      !VAST 58
      REAL, INTENT(IN) :: T                                                       !VAST 59
      REAL, INTENT(IN) :: AMU0                                                    !VAST 60
      REAL, INTENT(OUT) :: RDIF                                                   !VAST 61
      REAL, INTENT(OUT) :: TDIF                                                   !VAST 62
      REAL, INTENT(OUT) :: RDIR                                                   !VAST 63
      REAL, INTENT(OUT) :: TDD                                                    !VAST 64
      REAL, INTENT(OUT) :: TBEAM                                                  !VAST 65
!VAST...Calls: EXPR                                                               !VAST 66
      END SUBROUTINE                                                              !VAST 67
      END INTERFACE                                                               !VAST 68
      END MODULE                                                                  !VAST 69
!============================================================================     !VAST 70
      MODULE expr_I                                                               !VAST 71
      INTERFACE                                                                   !VAST 72
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 73
      REAL FUNCTION expr (X)                                                      !VAST 74
      real, INTENT(IN) :: X                                                       !VAST 75
      END FUNCTION                                                                !VAST 76
      END INTERFACE                                                               !VAST 77
      END MODULE                                                                  !VAST 78
!============================================================================     !VAST 79
      MODULE cp_I                                                                 !VAST 80
      INTERFACE                                                                   !VAST 81
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 82
      REAL FUNCTION cp (T)                                                        !VAST 83
      real, INTENT(IN) :: T                                                       !VAST 84
      END FUNCTION                                                                !VAST 85
      END INTERFACE                                                               !VAST 86
      END MODULE                                                                  !VAST 87
!============================================================================     !VAST 88
!.....Program to compute longwave and shortwave fluxes at surface and             !MRAD  1
!     top of atmosphere of Mars. Longwave calculations are by the                 !MRAD  2
!     method of Savijarvi (1991). Shortwave fluxes are by delta-                  !MRAD  3
!     Eddington method.  Optionally, heating rates due to water vapor,            !MRAD  4
!     carbon dioxide, and dust can also be calculated.                            !MRAD  5
!                                                                                 !MRAD  6
      program main                                                                !MRAD  7
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !MRAD  8
!...Switches:                                                                     !MRAD  9
!-----------------------------------------------                                  !MRAD 10
!   I n t e r f a c e   B l o c k s                                               !MRAD 11
!-----------------------------------------------                                  !MRAD 12
      use qrhtp_I                                                                 !MRAD 13
      use emitt_I                                                                 !MRAD 14
      use epsdust_I                                                               !MRAD 15
      use delted_I                                                                !MRAD 16
      use expr_I                                                                  !MRAD 17
      use cp_I                                                                    !MRAD 18
      implicit none                                                               !MRAD 19
!-----------------------------------------------                                  !MRAD 20
!   L o c a l   V a r i a b l e s                                                 !MRAD 21
!-----------------------------------------------                                  !MRAD 22
      integer :: heatrate, nvar, n, ieof, i, ice, icepolar, j, k                  !MRAD 23
      real , dimension(1000) :: p, q, dtdt, uw, fdown, fup, fnet, e, uc, t,     & !MRAD 24
         udust, co2abs, qdust                                                     !MRAD 25
      real , dimension(2) :: varx                                                 !MRAD 26
      real , dimension(1000) :: gz                                                !MRAD 27
      real :: rhoco2, co2, p0, expn, rh, gdust, omega0, e0, sigma, pi180, tsubn & !MRAD 28
         , pnm, tc, psubn, hrho, hpres, wtmol, thgt, tgrnd, dlo, dav, dhi, dtot & !MRAD 29
         , tauin, rad, gin, aumarsin, albedoin, amu0in, darea, qdustn, dmass,   & !MRAD 30
         dnum, varx1, vary1, aumars, albedo, amu0, thet, ts, ufact, cfact,      & !MRAD 31
         dustfact, e0mars, egrnd, pj, qj, scalfact, deltap, qdustj, deltau, u1w & !MRAD 32
         , u1c, airmass, tkp, epsk, epskp, femit, tsky, teff, tau, rdif, tdif,  & !MRAD 33
         rdir, tdir, tbeam, edntoa, albsurf, ednsfc, eupsfc, euptoa, eabsorb,   & !MRAD 34
         planalb, abssfc, emitspa, swdtdt                                         !MRAD 35
      character :: header*2                                                       !MRAD 36
!-----------------------------------------------                                  !MRAD 37
!...  Set parameter to control output of heating rates                            !MRAD 38
      data heatrate/ 0/                                                           !MRAD 39
!     Standard density of CO2 (at p = 1000 mb, T = 273 K)                         !MRAD 40
      data rhoco2/ 1.92/                                                          !MRAD 41
!     Standard concentration for CO2 (% by volume)                                !MRAD 42
      data co2/ 95.3/                                                             !MRAD 43
!     Reference pressure (mb) for scaled optical path lengths                     !MRAD 44
      data p0/ 1000./                                                             !MRAD 45
!     Exponent for pressure scaling for optical path lengths                      !MRAD 46
      data expn/ 0.75/                                                            !MRAD 47
!     Constant rh (0-1) for water vapor concentration                             !MRAD 48
      data rh/ 0.2/                                                               !MRAD 49
!     Dust asymmetry parameter                                                    !MRAD 50
      data gdust/ 0.7/                                                            !MRAD 51
!     Dust single-scatter albedo                                                  !MRAD 52
      data omega0/ 0.9/                                                           !MRAD 53
!     Solar constant (at 1AU), W/m**2                                             !MRAD 54
      data e0/ 1367./                                                             !MRAD 55
!     sigma = Stephan-Boltzmann constant                                          !MRAD 56
      data sigma/ 5.6704E-8/                                                      !MRAD 57
      pi180 = atan(1.0)/45.0                                                      !MRAD 58
      open(28, file='Radlist.txt', position='asis')                               !MRAD 59
      open(29, file='Radout.txt', position='asis')                                !MRAD 60
      open(20, file='TPresHgt.txt', status='old', position='asis')                !MRAD 61
      open(21, file='Density.txt', status='old', position='asis')                 !MRAD 62
      open(22, file='MarsRad.txt', status='old', position='asis')                 !MRAD 63
      read (20, 1) header                                                         !MRAD 64
      read (21, 1) header                                                         !MRAD 65
      read (22, 1) header                                                         !MRAD 66
    1 format(a2)                                                                  !MRAD 67
    5 continue                                                                    !MRAD 68
      write (*, *) ' Enter 1 or 2 for number of Mars-GRAM plot variables'         !MRAD 69
      read (*, *) nvar                                                            !MRAD 70
      if (nvar<1 .or. nvar>2) go to 5                                             !MRAD 71
      if (nvar == 1) then                                                         !MRAD 72
         write (29, 6)                                                            !MRAD 73
      else                                                                        !MRAD 74
         write (29, 7)                                                            !MRAD 75
      endif                                                                       !MRAD 76
    6 format('    Var_X   albsfc  tau RadAU     mu0 ice  Tsfc',&                  !MRAD 77
         ' Fusfc  Tsky Fdsfc Teff  Futoa Edsfc Eusfc Edtoa Eutoa',&               !MRAD 78
         ' planalb thet  Tdif  Tdir Tbeam')                                       !MRAD 79
    7 format('    Var_X        Var_Y    albsfc  tau RadAU     mu0 ice',        &  !MRAD 80
         '  Tsfc Fusfc  Tsky Fdsfc Teff  Futoa Edsfc Eusfc Edtoa',&               !MRAD 81
         ' Eutoa planalb thet  Tdif  Tdir Tbeam')                                 !MRAD 82
      write (*, *) ' Enter 1 for heat rate calculations, 0 for none'              !MRAD 83
      read (*, *) heatrate                                                        !MRAD 84
!.    Read sounding input data: p(mb), T(K), from Mars-GRAM output                !MRAD 85
      n = 0                                                                       !MRAD 86
      ieof = 0                                                                    !MRAD 87
   10 continue                                                                    !MRAD 88
      read (20, *, end=14) (varx(i),i=1,nvar), tsubn, pnm, tc, psubn, hrho,    &  !MRAD 89
         hpres, wtmol, thgt, tgrnd                                                !MRAD 90
      read (21, *) (varx(i),i=1,nvar), dlo, dav, dhi, dtot, tauin, rad, gin,   &  !MRAD 91
         aumarsin                                                                 !MRAD 92
      read (22, *) (varx(i),i=1,nvar), albedoin, amu0in, darea, qdustn, dmass, &  !MRAD 93
         dnum, ice                                                                !MRAD 94
      n = n + 1                                                                   !MRAD 95
      go to 16                                                                    !MRAD 96
   14 continue                                                                    !MRAD 97
      ieof = 1                                                                    !MRAD 98
      n = n + 1                                                                   !MRAD 99
      go to 20                                                                    !MRAD100
   16 continue                                                                    !MRAD101
      if (n == 1) then                                                            !MRAD102
         if (tgrnd > 900.) stop ' Bad surface temperature'                        !MRAD103
         if (ice > 90) stop ' Bad polar ice indicator'                            !MRAD104
         varx1 = varx(1)                                                          !MRAD105
         vary1 = varx(2)                                                          !MRAD106
      endif                                                                       !MRAD107
      if (n>2 .and. psubn>=p(n-1)) go to 20                                       !MRAD108
      if (n==2 .and. psubn>=p(1) .and. tgrnd<900.) then                           !MRAD109
         n = 1                                                                    !MRAD110
         go to 10                                                                 !MRAD111
      endif                                                                       !MRAD112
      t(n) = tsubn                                                                !MRAD113
      p(n) = psubn                                                                !MRAD114
      gz(n) = gin                                                                 !MRAD115
      qdust(n) = qdustn                                                           !MRAD116
      aumars = aumarsin                                                           !MRAD117
      albedo = albedoin                                                           !MRAD118
      amu0 = amu0in                                                               !MRAD119
!     Compute solar zenith angle (deg)                                            !MRAD120
      thet = acos(amu0in)/pi180                                                   !MRAD121
      if (tgrnd < 900.) ts = tgrnd                                                !MRAD122
      if (ice < 90) icepolar = ice                                                !MRAD123
!     optical path factor for water vapor, optical paths in g/cm**2               !MRAD124
      ufact = 1./(100.*gin)                                                       !MRAD125
!     optical path factor for CO2, optical paths in atm. cm                       !MRAD126
      cfact = 100.*(44.0/43.5)*co2/(gin*rhoco2)                                   !MRAD127
!     dust optical path factor                                                    !MRAD128
      dustfact = 100./(5.0E-3*gin)                                                !MRAD129
      if (amu0 > 1.0) amu0 = 1.                                                   !MRAD130
      amu0 = amax1(0.0,amu0)                                                      !MRAD131
      e0mars = e0/aumars**2                                                       !MRAD132
      e(n) = sigma*t(n)**4                                                        !MRAD133
      q(n) = qrhtp(rh,t(n),p(n))                                                  !MRAD134
      if (ieof == 1) go to 20                                                     !MRAD135
      go to 10                                                                    !MRAD136
   20 continue                                                                    !MRAD137
      p(n) = 0.                                                                   !MRAD138
      t(n) = t(n-1)                                                               !MRAD139
      dtdt(n) = 0.                                                                !MRAD140
      qdust(n) = 0.                                                               !MRAD141
      e(n) = e(n-1)                                                               !MRAD142
      q(n) = 0.                                                                   !MRAD143
      gz(n) = gz(n-1)                                                             !MRAD144
!     Compute optical path lengths, uw(j) and uc(j) for each pressure             !MRAD145
!     level, j = 1 to n, starting at the surface.                                 !MRAD146
      uw(1) = 0.                                                                  !MRAD147
      uc(1) = 0.                                                                  !MRAD148
      udust(1) = 0.                                                               !MRAD149
!     LW flux from surface                                                        !MRAD150
      egrnd = sigma*ts**4                                                         !MRAD151
      do j = 1, n - 1                                                             !MRAD152
!        Layer-average pressure                                                   !MRAD153
         pj = 0.5*(p(j)+p(j+1))                                                   !MRAD154
!        Layer-average water vapor mixing ratio                                   !MRAD155
         qj = 0.5*(q(j)+q(j+1))                                                   !MRAD156
!        Pressure scaling factor for water vapor and CO2                          !MRAD157
         scalfact = (pj/p0)**expn                                                 !MRAD158
         deltap = p(j+1) - p(j)                                                   !MRAD159
!        Layer-average dust mixing ratio                                          !MRAD160
         qdustj = 0.5*(qdust(j)+qdust(j+1))                                       !MRAD161
         deltau = ufact*qj*deltap*scalfact                                        !MRAD162
!        water vapor optical path (g/cm**2)                                       !MRAD163
         uw(j+1) = uw(j) - deltau                                                 !MRAD164
!        CO2 optical path (cm)                                                    !MRAD165
         uc(j+1) = uc(j) - cfact*deltap*scalfact                                  !MRAD166
!        dust optical path                                                        !MRAD167
         udust(j+1) = udust(j) - dustfact*deltap*qdustj                           !MRAD168
      end do                                                                      !MRAD169
!     u1w, u1c = total optical path for water vapor and CO2.                      !MRAD170
      u1w = uw(n)                                                                 !MRAD171
      u1c = uc(n)                                                                 !MRAD172
!     Step through each of the pressure levels, and compute integrals             !MRAD173
!     for the upwelling and downwelling fluxes                                    !MRAD174
      airmass = 100.                                                              !MRAD175
      if (amu0 > 0.01) airmass = 1./amu0                                          !MRAD176
      do j = 1, n                                                                 !MRAD177
         fup(j) = egrnd                                                           !MRAD178
         fdown(j) = 0.                                                            !MRAD179
         co2abs(j) = 0.0021*(abs(u1c - uc(j))*airmass)**0.3                       !MRAD180
         if (j /= 1) then                                                         !MRAD181
            do k = 1, j - 1                                                       !MRAD182
               tkp = 0.5*(t(k+1)+t(j))                                            !MRAD183
               epsk = emitt(uw(j)-uw(k),uc(j)-uc(k),tkp) + epsdust(udust(j)-    & !MRAD184
                  udust(k))                                                       !MRAD185
               epskp = emitt(uw(j)-uw(k+1),uc(j)-uc(k+1),tkp) + epsdust(udust(j & !MRAD186
                  )-udust(k+1))                                                   !MRAD187
               fup(j) = fup(j) + 0.5*(epskp + epsk)*(e(k+1)-e(k))                 !MRAD188
            end do                                                                !MRAD189
         endif                                                                    !MRAD190
         if (j /= n) then                                                         !MRAD191
            do k = n - 1, j, -1                                                   !MRAD192
               tkp = 0.5*(t(k+1)+t(j))                                            !MRAD193
               epsk = emitt(uw(k)-uw(j),uc(k)-uc(j),tkp) + epsdust(udust(k)-    & !MRAD194
                  udust(j))                                                       !MRAD195
               epskp = emitt(uw(k+1)-uw(j),uc(k+1)-uc(j),tkp) + epsdust(udust(k & !MRAD196
                  +1)-udust(j))                                                   !MRAD197
               fdown(j) = fdown(j) + 0.5*(e(k)+e(k+1))*(epskp - epsk)             !MRAD198
            end do                                                                !MRAD199
         endif                                                                    !MRAD200
         fnet(j) = fup(j) - fdown(j)                                              !MRAD201
      end do                                                                      !MRAD202
      femit = fdown(1) + fup(n) - fup(1)                                          !MRAD203
      if (nvar == 1) then                                                         !MRAD204
         write (28, 205) varx1                                                    !MRAD205
      else                                                                        !MRAD206
         write (28, 210) varx1, vary1                                             !MRAD207
      endif                                                                       !MRAD208
      write (28, 215) tauin, aumars, amu0, icepolar                               !MRAD209
  205 format(' Var_X =',g13.5)                                                    !MRAD210
  210 format(' Var_X =',g13.5,'   Var_Y =',g13.5)                                 !MRAD211
  215 format(' tau =',f5.2,'  MarsAU =',f6.3,'   mu0 =',f9.5,'   ice =',i3)       !MRAD212
      write (28, 220) fdown(1), fup(1), fup(n), femit                             !MRAD213
  220 format(' Longwave fluxes F (W/m**2):'/,' Fdown(sfc)=',f6.1,'  Fup(sfc)=', & !MRAD214
         f6.1,'  Fup(toa)=',f6.1,'  Femit(atmos)=',f6.1)                          !MRAD215
      tsky = (fdown(1)/sigma)**0.25                                               !MRAD216
      teff = (fup(n)/sigma)**0.25                                                 !MRAD217
      write (28, 240) tsky, ts, teff                                              !MRAD218
  240 format(' Radiative temperatures (K):'/,' Tsky(sfc) =',f6.1,'     Tsfc =', & !MRAD219
         f6.1,'  Teff(toa) = ',f6.1)                                              !MRAD220
!...  Clear atmosphere increment for optical depth (Savijarvi, 1991)              !MRAD221
      tau = tauin + 0.0015                                                        !MRAD222
      call delted (gdust, omega0, tau, amu0, rdif, tdif, rdir, tdir, tbeam)       !MRAD223
      edntoa = e0mars*amu0                                                        !MRAD224
      albsurf = albedo                                                            !MRAD225
      if (icepolar == 1) albsurf = 0.52                                           !MRAD226
      ednsfc = edntoa*expr((-co2abs(1)))*(tbeam + tdir)/(1. - albsurf*rdif)       !MRAD227
      if (icepolar == 1) then                                                     !MRAD228
!...    Surface albedo for polar ice (Kieffer et al., Mars, 1992,                 !MRAD229
!         page 1201)                                                              !MRAD230
         albsurf = 0.52 + 9.2E-4*ednsfc                                           !MRAD231
         ednsfc = edntoa*expr((-co2abs(1)))*(tbeam + tdir)/(1. - albsurf*rdif)    !MRAD232
      endif                                                                       !MRAD233
      eupsfc = albsurf*ednsfc                                                     !MRAD234
      euptoa = edntoa*rdir + eupsfc*tdif                                          !MRAD235
      eabsorb = edntoa - ednsfc + eupsfc - euptoa                                 !MRAD236
      planalb = 0.0                                                               !MRAD237
      if (edntoa > 0.0) planalb = euptoa/edntoa                                   !MRAD238
      write (28, 250) ednsfc, eupsfc, euptoa, eabsorb                             !MRAD239
  250 format(' Shortwave fluxes E (W/m**2):'/,' Edown(sfc)=',f6.1,'  Eup(sfc)=' & !MRAD240
         ,f6.1,'  Eup(toa)=',f6.1,'  Eabsorb(atmos)=',f6.1)                       !MRAD241
      if (thet > 90.0) then                                                       !MRAD242
         tdif = 0.0                                                               !MRAD243
         tdir = 0.0                                                               !MRAD244
         tbeam = 0.0                                                              !MRAD245
      endif                                                                       !MRAD246
      write (28, 255) thet, tdif, tdir, tbeam                                     !MRAD247
  255 format(' SZA(deg)=',f6.1,'  Tdif(sfc)=',f6.3,'  Tdir(sfc)=',f6.3,       &   !MRAD248
         '  Tbeam(sfc)=',f6.3)                                                    !MRAD249
      write (28, 260) albsurf, planalb, edntoa                                    !MRAD250
  260 format(' Surface albedo =',f6.3,'   Planetary albedo =',f6.3,           &   !MRAD251
         '   Edown(toa) =',f6.1)                                                  !MRAD252
      abssfc = ednsfc + fdown(1) - eupsfc - fup(1)                                !MRAD253
      emitspa = euptoa + fup(n)                                                   !MRAD254
      write (28, 270) abssfc, emitspa                                             !MRAD255
  270 format(' SW+LW (W/m**2):'/,' Absorbed(sfc) =',f7.1,'   Emitted(toa) =', &   !MRAD256
         f6.1)                                                                    !MRAD257
!...  Bypass heating rates if heatrate=0                                          !MRAD258
      if (heatrate == 1) then                                                     !MRAD259
!     Compute longwave heating rate                                               !MRAD260
         do j = 1, n - 1                                                          !MRAD261
            dtdt(j) = 864.*(gz(j)/cp(t(j)))*(fnet(j)-fnet(j+1))/(p(j)-p(j+1))     !MRAD262
         end do                                                                   !MRAD263
!     Write out optical path, broadband longwave fluxes, longwave,                !MRAD264
!      shortwave, and total heating rates                                         !MRAD265
         write (28, 310)                                                          !MRAD266
  310    format('   Pres  uH2O  uCO2 udust   ',                                 & !MRAD267
            'LWFup   LWFdn  LWFnet  LWdTdt  SWdTdt TotdTdt'/,                   & !MRAD268
            '    mb   mu.m atmcm        W/m**2  W/m**2 ',                       & !MRAD269
            ' W/m**2   K/day   K/day   K/day')                                    !MRAD270
         do j = 1, n - 1                                                          !MRAD271
            swdtdt = 0.                                                           !MRAD272
            if (tau > 0.) swdtdt = 864.*(gz(j)/cp(t(j)))*(edntoa*(co2abs(j+1)-  & !MRAD273
               co2abs(j))-eabsorb*((udust(j+1)-udust(j))/tau))/(p(j+1)-p(j))      !MRAD274
            write (28, 410) p(j), 10000.*uw(j), uc(j), udust(j), fup(j), fdown( & !MRAD275
               j), fnet(j), dtdt(j), swdtdt, swdtdt + dtdt(j)                     !MRAD276
         end do                                                                   !MRAD277
  410    format(f7.3,f6.2,f6.1,f6.3,6f8.1)                                        !MRAD278
      endif                                                                       !MRAD279
      if (nvar == 1) then                                                         !MRAD280
         write (29, 830) varx1, albsurf, tauin, aumars, amu0, icepolar, ts, fup & !MRAD281
            (1), tsky, fdown(1), teff, fup(n), ednsfc, eupsfc, edntoa, euptoa,  & !MRAD282
            planalb, thet, tdif, tdir, tbeam                                      !MRAD283
      else                                                                        !MRAD284
         write (29, 840) varx1, vary1, albsurf, tauin, aumars, amu0, icepolar,  & !MRAD285
            ts, fup(1), tsky, fdown(1), teff, fup(n), ednsfc, eupsfc, edntoa,   & !MRAD286
            euptoa, planalb, thet, tdif, tdir, tbeam                              !MRAD287
      endif                                                                       !MRAD288
  830 format(g13.5,f6.3,f5.2,f6.3,f9.5,i3,10f6.1,f6.3,f7.1,3f6.3)                 !MRAD289
  840 format(2g13.5,f6.3,f5.2,f6.3,f9.5,i3,10f6.1,f6.3,f7.1,3f6.3)                !MRAD290
      write (28, 850)                                                             !MRAD291
  850 format(' ------------------------------------------------------',         & !MRAD292
         '------------------')                                                    !MRAD293
      if (ieof == 1) go to 999                                                    !MRAD294
      n = 1                                                                       !MRAD295
      go to 16                                                                    !MRAD296
  999 continue                                                                    !MRAD297
      write (*, *) ' Output written to files Radlist.txt and Radout.txt'          !MRAD298
      stop                                                                        !MRAD299
      end program main                                                            !MRAD300
!                                                                                 !MRAD301
!----------------------------------------------------------------------           !CPOT  1
      REAL FUNCTION CP (T)                                                        !CPOT  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !CPOT  3
!...Switches:                                                                     !CPOT  4
      IMPLICIT NONE                                                               !CPOT  5
!-----------------------------------------------                                  !CPOT  6
!   D u m m y   A r g u m e n t s                                                 !CPOT  7
!-----------------------------------------------                                  !CPOT  8
      REAL , INTENT(IN) :: T                                                      !CPOT  9
!-----------------------------------------------                                  !CPOT 10
!   L o c a l   V a r i a b l e s                                                 !CPOT 11
!-----------------------------------------------                                  !CPOT 12
!-----------------------------------------------                                  !CPOT 13
!...  Specific heat at constant pressure, as function of temperature              !CPOT 14
!...  T in kelvins; Cp in joules kg**-1 K**-1                                     !CPOT 15
      CP = 639.5 + 0.123687*T + 0.00200225*T*T                                    !CPOT 16
      RETURN                                                                      !CPOT 17
      END FUNCTION CP                                                             !CPOT 18
!                                                                                 !CPOT 19
!----------------------------------------------------------------------           !DEDT  1
      subroutine delted(g, om, t, amu0, rdif, tdif, rdir, tdd, tbeam)             !DEDT  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !DEDT  3
!...Switches:                                                                     !DEDT  4
!-----------------------------------------------                                  !DEDT  5
!   I n t e r f a c e   B l o c k s                                               !DEDT  6
!-----------------------------------------------                                  !DEDT  7
      use expr_I                                                                  !DEDT  8
      implicit none                                                               !DEDT  9
!-----------------------------------------------                                  !DEDT 10
!   D u m m y   A r g u m e n t s                                                 !DEDT 11
!-----------------------------------------------                                  !DEDT 12
      real , intent(in) :: g                                                      !DEDT 13
      real , intent(in) :: om                                                     !DEDT 14
      real , intent(in) :: t                                                      !DEDT 15
      real , intent(in) :: amu0                                                   !DEDT 16
      real , intent(out) :: rdif                                                  !DEDT 17
      real , intent(out) :: tdif                                                  !DEDT 18
      real , intent(out) :: rdir                                                  !DEDT 19
      real , intent(out) :: tdd                                                   !DEDT 20
      real , intent(out) :: tbeam                                                 !DEDT 21
!-----------------------------------------------                                  !DEDT 22
!   L o c a l   V a r i a b l e s                                                 !DEDT 23
!-----------------------------------------------                                  !DEDT 24
      real :: small, gp, ts, omp, ak, p, et, etm, emu, alfa, beta, am, ap, pp, &  !DEDT 25
         pm, denom1, denom2, c2num, c2, c1, tdir                                  !DEDT 26
!-----------------------------------------------                                  !DEDT 27
!     Reflectance and transmittance for layer by Delta-Eddington                  !DEDT 28
!        method (Joseph et al., J. Atmos. Sci., 33, 2452, 1976).                  !DEDT 29
!     Computes for both beam irradiance and diffuse irradiance at top             !DEDT 30
!        of layer.                                                                !DEDT 31
!     Inputs are:                                                                 !DEDT 32
!        g    = asymmetry factor                                                  !DEDT 33
!        om   = single-scatter albedo                                             !DEDT 34
!        t    = vertically normalized optical depth for layer                     !DEDT 35
!        amu0 = cosine solar zenith angle (for beam irradiance)                   !DEDT 36
!     Outputs are:                                                                !DEDT 37
!        Rdif = diffuse reflectance for diffuse irradiance                        !DEDT 38
!        Tdif = diffuse transmittance for diffuse irradiance                      !DEDT 39
!        Rdir = diffuse reflectance for beam irradiance                           !DEDT 40
!        Tdd  = diffuse transmittance for beam irradiance                         !DEDT 41
!        Tbeam = beam transmittance                                               !DEDT 42
      rdif = 0.                                                                   !DEDT 43
      tdif = 1.                                                                   !DEDT 44
      rdir = 0.                                                                   !DEDT 45
      tdd = 1.                                                                    !DEDT 46
      tbeam = 1.                                                                  !DEDT 47
      if (amu0 <= 0.01) return                                                    !DEDT 48
      small = 1.0E-42                                                             !DEDT 49
      gp = g/(1. + g)                                                             !DEDT 50
      tbeam = expr((-t/amu0))                                                     !DEDT 51
      ts = (1 - om*g**2)*t                                                        !DEDT 52
      omp = (1 - g**2)*om/(1 - om*g**2)                                           !DEDT 53
      ak = sqrt(3.*(1. - omp)*(1. - omp*gp))                                      !DEDT 54
      p = sqrt(3.*(1. - omp)/(1. - omp*gp))                                       !DEDT 55
      et = expr(ts*ak)                                                            !DEDT 56
      etm = 1./et                                                                 !DEDT 57
      emu = expr((-ts/amu0))                                                      !DEDT 58
      alfa = 3.*omp*amu0**2*(1. + gp*(1. - omp))/(4.*(1. - ak**2*amu0**2))        !DEDT 59
      beta = 3.*omp*amu0*(1. + 3.*gp*(1. - omp)*amu0**2)/(4.*(1. - ak**2*amu0** & !DEDT 60
         2))                                                                      !DEDT 61
      am = alfa - 2.*beta/3.                                                      !DEDT 62
      ap = alfa + 2.*beta/3.                                                      !DEDT 63
      pp = 1. + 2.*p/3.                                                           !DEDT 64
      pm = 1. - 2.*p/3.                                                           !DEDT 65
      rdif = pm/pp                                                                !DEDT 66
      if (rdif < 0) rdif = 0.                                                     !DEDT 67
      tdif = 0.                                                                   !DEDT 68
      if (etm >= small) then                                                      !DEDT 69
         denom1 = pm*pm*etm - pp*pp*et                                            !DEDT 70
         tdif = etm*(1. + pm*pm*(et - etm)/denom1)                                !DEDT 71
         rdif = (pm/pp)*(1. + etm*(pp*pp - pm*pm)/denom1)                         !DEDT 72
         rdif = amax1(0.,rdif)                                                    !DEDT 73
      endif                                                                       !DEDT 74
      denom2 = et*pp*pp - etm*pm*pm                                               !DEDT 75
      c2num = emu*am*pp - etm*pm*ap                                               !DEDT 76
      c2 = 0.                                                                     !DEDT 77
      if (abs(c2num) > small*abs(denom2)) c2 = c2num/denom2                       !DEDT 78
      c1 = (ap - pm*c2)/pp                                                        !DEDT 79
      rdir = (pm*c1 + pp*c2 - am)/amu0                                            !DEDT 80
      tdir = (pp*c1*etm + pm*c2*et - (ap - amu0)*emu)/amu0                        !DEDT 81
      tdd = tdir - tbeam                                                          !DEDT 82
      return                                                                      !DEDT 83
      end subroutine delted                                                       !DEDT 84
!                                                                                 !DEDT 85
!----------------------------------------------------------------------           !EMIT  1
      real function emitt (uw, uc, t)                                             !EMIT  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !EMIT  3
!...Switches:                                                                     !EMIT  4
!-----------------------------------------------                                  !EMIT  5
!   I n t e r f a c e   B l o c k s                                               !EMIT  6
!-----------------------------------------------                                  !EMIT  7
      use epsilonc_I                                                              !EMIT  8
      use epsilonw_I                                                              !EMIT  9
      implicit none                                                               !EMIT 10
!-----------------------------------------------                                  !EMIT 11
!   D u m m y   A r g u m e n t s                                                 !EMIT 12
!-----------------------------------------------                                  !EMIT 13
      real  :: uw                                                                 !EMIT 14
      real  :: uc                                                                 !EMIT 15
      real  :: t                                                                  !EMIT 16
!-----------------------------------------------                                  !EMIT 17
!   L o c a l   V a r i a b l e s                                                 !EMIT 18
!-----------------------------------------------                                  !EMIT 19
      real :: epsc, epsw                                                          !EMIT 20
!-----------------------------------------------                                  !EMIT 21
!     Emittance from combined CO2 and water vapor                                 !EMIT 22
      epsc = epsilonc(uc,t)                                                       !EMIT 23
      epsw = epsilonw(uw,t)                                                       !EMIT 24
      emitt = epsw + epsc - epsw*epsc                                             !EMIT 25
      return                                                                      !EMIT 26
      end function emitt                                                          !EMIT 27
!                                                                                 !EMIT 28
!----------------------------------------------------------------------           !EPSC  1
      real function epsilonc (uc, t)                                              !EPSC  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !EPSC  3
!...Switches:                                                                     !EPSC  4
      implicit none                                                               !EPSC  5
!-----------------------------------------------                                  !EPSC  6
!   D u m m y   A r g u m e n t s                                                 !EPSC  7
!-----------------------------------------------                                  !EPSC  8
      real , intent(in) :: uc                                                     !EPSC  9
      real , intent(in) :: t                                                      !EPSC 10
!-----------------------------------------------                                  !EPSC 11
!   L o c a l   V a r i a b l e s                                                 !EPSC 12
!-----------------------------------------------                                  !EPSC 13
      integer :: j, i, m                                                          !EPSC 14
      real , dimension(4,23) :: ec                                                !EPSC 15
      real , dimension(23) :: alc                                                 !EPSC 16
      real , dimension(2) :: eci                                                  !EPSC 17
      real , dimension(4) :: ti                                                   !EPSC 18
      real :: al, epc                                                             !EPSC 19
!-----------------------------------------------                                  !EPSC 20
!...  Emittance due to CO2 path length uc (atm. cm) and                           !EPSC 21
!     temperature T (K), from Table 2 of Staley and Jurica, J. Appl.              !EPSC 22
!     Meteorol., vol.9, p.365, 1970.                                              !EPSC 23
!...  Emissivity tables in percent                                                !EPSC 24
      data (ec(1,j),j=1,23)/ 0.114, 0.162, 0.247, 0.331, 0.439, 0.641, 0.859,   & !EPSC 25
         1.19, 1.92, 2.78, 3.92, 5.76, 7.19, 8.60, 10.4, 11.7, 13.0, 14.7, 15.9 & !EPSC 26
         , 17.0, 18.6, 19.7, 20.7/                                                !EPSC 27
      data (ec(2,j),j=1,23)/ 0.119, 0.171, 0.262, 0.354, 0.471, 0.691, 0.928,   & !EPSC 28
         1.29, 2.08, 3.03, 4.30, 6.36, 7.99, 9.61, 11.7, 13.3, 14.8, 16.7, 18.1 & !EPSC 29
         , 19.5, 21.3, 22.6, 23.9/                                                !EPSC 30
      data (ec(3,j),j=1,23)/ 0.115, 0.167, 0.260, 0.352, 0.471, 0.693, 0.934,   & !EPSC 31
         1.30, 2.11, 3.08, 4.39, 6.54, 8.26, 10.0, 12.3, 13.9, 15.6, 17.7, 19.3 & !EPSC 32
         , 20.7, 22.7, 24.1, 25.4/                                                !EPSC 33
      data (ec(4,j),j=1,23)/ 0.108, 0.158, 0.248, 0.338, 0.454, 0.672, 0.907,   & !EPSC 34
         1.27, 2.07, 3.03, 4.32, 6.49, 8.23, 10.0, 12.4, 14.1, 15.8, 18.0, 19.6 & !EPSC 35
         , 21.1, 23.1, 24.4, 25.7/                                                !EPSC 36
      data alc/ -4.0, -3.7, -3.3, -3.0, -2.7, -2.3, -2.0, -1.7, -1.3, -1.0, &     !EPSC 37
         -0.7, -0.3, 0.0, 0.3, 0.7, 1.0, 1.3, 1.7, 2.0, 2.3, 2.7, 3.0, 3.3/       !EPSC 38
      data ti/ 203.15, 233.15, 263.15, 293.15/                                    !EPSC 39
      if (uc <= 0.0) then                                                         !EPSC 40
         epsilonc = 0.0                                                           !EPSC 41
         return                                                                   !EPSC 42
      endif                                                                       !EPSC 43
      al = alog10(uc)                                                             !EPSC 44
      if (al < alc(1)) then                                                       !EPSC 45
         i = 1                                                                    !EPSC 46
      else if (al > alc(22)) then                                                 !EPSC 47
         i = 22                                                                   !EPSC 48
      else                                                                        !EPSC 49
         do m = 2, 23                                                             !EPSC 50
            if (al >= alc(m)) cycle                                               !EPSC 51
            i = m - 1                                                             !EPSC 52
            exit                                                                  !EPSC 53
         end do                                                                   !EPSC 54
      endif                                                                       !EPSC 55
      j = 0                                                                       !EPSC 56
      if (t > ti(2)) j = 1                                                        !EPSC 57
      if (t > ti(3)) j = 2                                                        !EPSC 58
      eci = ec(1+j:2+j,i) + (al - alc(i))*(ec(1+j:2+j,i+1)-ec(1+j:2+j,i))/(alc( & !EPSC 59
         i+1)-alc(i))                                                             !EPSC 60
      epc = eci(1) + (t - ti(1+j))*(eci(2)-eci(1))/(ti(2+j)-ti(1+j))              !EPSC 61
      epc = amax1(0.0,epc)                                                        !EPSC 62
      epc = amin1(100.0,epc)                                                      !EPSC 63
      epsilonc = epc/100.                                                         !EPSC 64
      return                                                                      !EPSC 65
      end function epsilonc                                                       !EPSC 66
!                                                                                 !EPSC 67
!----------------------------------------------------------------------           !EPSD  1
      real function epsdust (tau)                                                 !EPSD  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !EPSD  3
!...Switches:                                                                     !EPSD  4
      implicit none                                                               !EPSD  5
!-----------------------------------------------                                  !EPSD  6
!   D u m m y   A r g u m e n t s                                                 !EPSD  7
!-----------------------------------------------                                  !EPSD  8
      real , intent(in) :: tau                                                    !EPSD  9
!-----------------------------------------------                                  !EPSD 10
!   L o c a l   V a r i a b l e s                                                 !EPSD 11
!-----------------------------------------------                                  !EPSD 12
      real :: c0, c1, c2, c3, c4, altau                                           !EPSD 13
!-----------------------------------------------                                  !EPSD 14
!     Longwave emittance from dust as a function of solar optical depth           !EPSD 15
!     (tau) by the method of Haberle et al., Icarus, vol. 50, p.322,              !EPSD 16
!     1982 (Table II)                                                             !EPSD 17
      data c0, c1, c2, c3, c4/ -2.365E-4, 2.082E-1, 6.409E-2, -4.700E-2,    &     !EPSD 18
         7.217E-3/                                                                !EPSD 19
      altau = alog(1. + tau)                                                      !EPSD 20
      epsdust = (((c4*altau + c3)*altau + c2)*altau + c1)*altau + c0              !EPSD 21
      return                                                                      !EPSD 22
      end function epsdust                                                        !EPSD 23
!                                                                                 !EPSD 24
!----------------------------------------------------------------------           !EPSW  1
      real function epsilonw (uw, t)                                              !EPSW  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !EPSW  3
!...Switches:                                                                     !EPSW  4
      implicit none                                                               !EPSW  5
!-----------------------------------------------                                  !EPSW  6
!   D u m m y   A r g u m e n t s                                                 !EPSW  7
!-----------------------------------------------                                  !EPSW  8
      real , intent(in) :: uw                                                     !EPSW  9
      real , intent(in) :: t                                                      !EPSW 10
!-----------------------------------------------                                  !EPSW 11
!   L o c a l   V a r i a b l e s                                                 !EPSW 12
!-----------------------------------------------                                  !EPSW 13
      integer :: j, i, m                                                          !EPSW 14
      real , dimension(4,21) :: ew                                                !EPSW 15
      real , dimension(21) :: alw                                                 !EPSW 16
      real , dimension(2) :: ewi                                                  !EPSW 17
      real , dimension(4) :: ti                                                   !EPSW 18
      real :: al, epw                                                             !EPSW 19
!-----------------------------------------------                                  !EPSW 20
!...  Emittance due to H2O path length uw (g / cm**2) and                         !EPSW 21
!     temperature T (K), from Table 1 of Staley and Jurica, J. Appl.              !EPSW 22
!     Meteorol., vol.9, p.365, 1970.                                              !EPSW 23
!...  Emissivity tables in percent                                                !EPSW 24
      data (ew(1,j),j=1,21)/ 2.16, 3.16, 5.11, 7.16, 9.77, 14.1, 18.0, 22.3,    & !EPSW 25
         28.3, 32.6, 36.8, 42.2, 46.2, 50.2, 56.0, 61.1, 67.3, 77.4, 85.3, 91.5 & !EPSW 26
         , 95.8/                                                                  !EPSW 27
      data (ew(2,j),j=1,21)/ 1.90, 2.72, 4.40, 6.16, 8.41, 12.2, 15.7, 19.6,    & !EPSW 28
         25.1, 29.2, 33.3, 38.8, 42.8, 47.1, 53.4, 59.1, 66.2, 77.8, 86.8, 93.8 & !EPSW 29
         , 98.0/                                                                  !EPSW 30
      data (ew(3,j),j=1,21)/ 1.86, 2.58, 4.11, 5.72, 7.81, 11.4, 14.6, 18.3,    & !EPSW 31
         23.6, 27.7, 31.9, 37.4, 41.7, 46.2, 52.9, 59.0, 66.6, 78.8, 88.1, 95.1 & !EPSW 32
         , 98.8/                                                                  !EPSW 33
      data (ew(4,j),j=1,21)/ 1.96, 2.62, 4.09, 5.65, 7.68, 11.2, 14.3, 18.0,    & !EPSW 34
         23.2, 27.3, 31.6, 37.3, 41.8, 46.5, 53.6, 60.0, 67.7, 79.8, 88.8, 95.4 & !EPSW 35
         , 98.7/                                                                  !EPSW 36
      data alw/ -5.0, -4.7, -4.3, -4.0, -3.7, -3.3, -3.0, -2.7, -2.3, -2.0,     & !EPSW 37
         -1.7, -1.3, -1.0, -0.7, -0.3, 0.0, 0.3, 0.7, 1.0, 1.3, 1.7/              !EPSW 38
      data ti/ 203.15, 233.15, 263.15, 293.15/                                    !EPSW 39
      if (uw <= 0.0) then                                                         !EPSW 40
         epsilonw = 0.0                                                           !EPSW 41
         return                                                                   !EPSW 42
      endif                                                                       !EPSW 43
      al = alog10(uw)                                                             !EPSW 44
      if (al < alw(1)) then                                                       !EPSW 45
         i = 1                                                                    !EPSW 46
      else if (al > alw(20)) then                                                 !EPSW 47
         i = 20                                                                   !EPSW 48
      else                                                                        !EPSW 49
         do m = 2, 21                                                             !EPSW 50
            if (al >= alw(m)) cycle                                               !EPSW 51
            i = m - 1                                                             !EPSW 52
            exit                                                                  !EPSW 53
         end do                                                                   !EPSW 54
      endif                                                                       !EPSW 55
      j = 0                                                                       !EPSW 56
      if (t > ti(2)) j = 1                                                        !EPSW 57
      if (t > ti(3)) j = 2                                                        !EPSW 58
      ewi = ew(1+j:2+j,i) + (al - alw(i))*(ew(1+j:2+j,i+1)-ew(1+j:2+j,i))/(alw( & !EPSW 59
         i+1)-alw(i))                                                             !EPSW 60
      epw = ewi(1) + (t - ti(1+j))*(ewi(2)-ewi(1))/(ti(2+j)-ti(1+j))              !EPSW 61
      epw = amax1(0.0,epw)                                                        !EPSW 62
      epw = amin1(100.0,epw)                                                      !EPSW 63
      epsilonw = epw/100.                                                         !EPSW 64
      return                                                                      !EPSW 65
      end function epsilonw                                                       !EPSW 66
!                                                                                 !EPSW 67
!----------------------------------------------------------------------           !EXPR  1
      REAL FUNCTION EXPR (X)                                                      !EXPR  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !EXPR  3
!...Switches:                                                                     !EXPR  4
      IMPLICIT NONE                                                               !EXPR  5
!-----------------------------------------------                                  !EXPR  6
!   D u m m y   A r g u m e n t s                                                 !EXPR  7
!-----------------------------------------------                                  !EXPR  8
      REAL , INTENT(IN) :: X                                                      !EXPR  9
!-----------------------------------------------                                  !EXPR 10
!   L o c a l   V a r i a b l e s                                                 !EXPR 11
!-----------------------------------------------                                  !EXPR 12
      REAL :: BIG, EX                                                             !EXPR 13
!-----------------------------------------------                                  !EXPR 14
!                                                                                 !EXPR 15
!     Special exponential function exp(x) which avoids arithmetic                 !EXPR 16
!     overflow at large x or arithmetic underflow at small x                      !EXPR 17
!                                                                                 !EXPR 18
      BIG = 85.                                                                   !EXPR 19
      IF (ABS(X) > BIG) THEN                                                      !EXPR 20
         EX = EXP(SIGN(1.,X)*BIG)                                                 !EXPR 21
      ELSE                                                                        !EXPR 22
         EX = EXP(X)                                                              !EXPR 23
      ENDIF                                                                       !EXPR 24
      EXPR = EX                                                                   !EXPR 25
      RETURN                                                                      !EXPR 26
      END FUNCTION EXPR                                                           !EXPR 27
!                                                                                 !EXPR 28
!----------------------------------------------------------------------           !QRHT  1
      real function qrhtp (rh, t, p)                                              !QRHT  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !QRHT  3
!...Switches:                                                                     !QRHT  4
      implicit none                                                               !QRHT  5
!-----------------------------------------------                                  !QRHT  6
!   D u m m y   A r g u m e n t s                                                 !QRHT  7
!-----------------------------------------------                                  !QRHT  8
      real , intent(in) :: rh                                                     !QRHT  9
      real , intent(in) :: t                                                      !QRHT 10
      real , intent(in) :: p                                                      !QRHT 11
!-----------------------------------------------                                  !QRHT 12
!   L o c a l   V a r i a b l e s                                                 !QRHT 13
!-----------------------------------------------                                  !QRHT 14
      real :: es                                                                  !QRHT 15
!-----------------------------------------------                                  !QRHT 16
!     Specific humidity q (g/kg) versus RH (0-1), temperature (K), and            !QRHT 17
!     pressure (mb) (Savijarvi, Contr. Atmos. Phys., 64, 103, 1991)               !QRHT 18
!                                                                                 !QRHT 19
!     Saturation water vapor pressure es vs temperature T                         !QRHT 20
      es = 6.1135*exp(22.542*(t - 273.16)/(t + 0.32))                             !QRHT 21
      qrhtp = 1000.*rh*0.407*es/(p - 0.59*es)                                     !QRHT 22
      return                                                                      !QRHT 23
      end function qrhtp                                                          !QRHT 24
