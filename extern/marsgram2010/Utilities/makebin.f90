      module vast_kind_param                                                      !VAST  1
         integer, parameter :: byte_log = selected_int_kind(2)                    !VAST  2
         integer, parameter :: short_log = selected_int_kind(4)                   !VAST  3
         integer, parameter :: long_log = selected_int_kind(18)                   !VAST  4
         integer, parameter :: byte = selected_int_kind(2)                        !VAST  5
         integer, parameter :: short = selected_int_kind(4)                       !VAST  6
         integer, parameter :: long = selected_int_kind(18)                       !VAST  7
         integer, parameter :: double = selected_real_kind(14)                    !VAST  8
         integer, parameter :: extended = selected_real_kind(30)                  !VAST  9
         integer, parameter :: double_ext = selected_real_kind(50)                !VAST 10
         integer, parameter :: dble_complex = selected_real_kind(14)              !VAST 11
         integer, parameter :: ext_complex = selected_real_kind(30)               !VAST 12
      end module vast_kind_param                                                  !VAST 13
!==============================================================================   !VAST 14
      MODULE dustbin_I                                                            !VAST 15
      INTERFACE                                                                   !VAST 16
!...Generated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10         !VAST 17
      SUBROUTINE dustbin (VERSION)                                                !VAST 18
      CHARACTER (LEN = 1), INTENT(IN) :: VERSION                                  !VAST 19
!...This routine performs I/O.                                                    !VAST 20
      END SUBROUTINE                                                              !VAST 21
      END INTERFACE                                                               !VAST 22
      END MODULE                                                                  !VAST 23
!==============================================================================   !VAST 24
      MODULE mgcmbin_I                                                            !VAST 25
      INTERFACE                                                                   !VAST 26
!...Generated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10         !VAST 27
      SUBROUTINE mgcmbin (VERSION)                                                !VAST 28
      character (LEN = 1), INTENT(IN) :: VERSION                                  !VAST 29
!...This routine performs I/O.                                                    !VAST 30
      END SUBROUTINE                                                              !VAST 31
      END INTERFACE                                                               !VAST 32
      END MODULE                                                                  !VAST 33
!==============================================================================   !VAST 34
      MODULE mtgcmbin_I                                                           !VAST 35
      INTERFACE                                                                   !VAST 36
!...Generated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10         !VAST 37
      SUBROUTINE mtgcmbin (VERSION)                                               !VAST 38
      CHARACTER (LEN = 1), INTENT(IN) :: VERSION                                  !VAST 39
!...This routine performs I/O.                                                    !VAST 40
      END SUBROUTINE                                                              !VAST 41
      END INTERFACE                                                               !VAST 42
      END MODULE                                                                  !VAST 43
!==============================================================================   !VAST 44
      MODULE surfbin_I                                                            !VAST 45
      INTERFACE                                                                   !VAST 46
!...Generated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10         !VAST 47
      SUBROUTINE surfbin (VERSION)                                                !VAST 48
      character (LEN = 1), INTENT(IN) :: VERSION                                  !VAST 49
!...This routine performs I/O.                                                    !VAST 50
      END SUBROUTINE                                                              !VAST 51
      END INTERFACE                                                               !VAST 52
      END MODULE                                                                  !VAST 53
!------ Program makebin --------------------------------------------------------  !MKBN  1
!                                                                                 !MKBN  2
!...    Makes binary files from ASCII versions of NASA Ames Mars Global           !MKBN  3
!       Circulation Model (MGCM) and University of Michigan Mars                  !MKBN  4
!       Thermospheric Global Circulation Model (MTGCM) data, for fast             !MKBN  5
!       reading on user system                                                    !MKBN  6
      program main                                                                !MKBN  7
!...Translated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10        !MKBN  8
!...Switches:                                                                     !MKBN  9
!-----------------------------------------------                                  !MKBN 10
!   I n t e r f a c e   B l o c k s                                               !MKBN 11
!-----------------------------------------------                                  !MKBN 12
      use surfbin_I                                                               !MKBN 13
      use mgcmbin_I                                                               !MKBN 14
      use mtgcmbin_I                                                              !MKBN 15
      use dustbin_I                                                               !MKBN 16
      implicit none                                                               !MKBN 17
!-----------------------------------------------                                  !MKBN 18
!   L o c a l   P a r a m e t e r s                                               !MKBN 19
!-----------------------------------------------                                  !MKBN 20
      character, parameter :: version = '1'                                       !MKBN 21
!-----------------------------------------------                                  !MKBN 22
      write (*, *) ' Reading MGCM surface data'                                   !MKBN 23
      call surfbin (version)                                                      !MKBN 24
      write (*, *) ' Reading MGCM -5 to 80 km data'                               !MKBN 25
      call mgcmbin (version)                                                      !MKBN 26
      write (*, *) ' Reading MTGCM 80 to 240 km data'                             !MKBN 27
      call mtgcmbin (version)                                                     !MKBN 28
      write (*, *) ' Reading TES dust data'                                       !MKBN 29
      call dustbin (version)                                                      !MKBN 30
      stop                                                                        !MKBN 31
      end program main                                                            !MKBN 32
!------------------------------------------------------------------------------   !SRFB  1
      subroutine surfbin(version)                                                 !SRFB  2
!-----------------------------------------------                                  !SRFB  3
!   M o d u l e s                                                                 !SRFB  4
!-----------------------------------------------                                  !SRFB  5
      USE vast_kind_param, ONLY:  double                                          !SRFB  6
!...    Reads ASCII version MGCM surface data and writes binary version           !SRFB  7
!...Translated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10        !SRFB  8
!...Switches:                                                                     !SRFB  9
      implicit none                                                               !SRFB 10
!-----------------------------------------------                                  !SRFB 11
!   D u m m y   A r g u m e n t s                                                 !SRFB 12
!-----------------------------------------------                                  !SRFB 13
      character , intent(in) :: version                                           !SRFB 14
!-----------------------------------------------                                  !SRFB 15
!   L o c a l   P a r a m e t e r s                                               !SRFB 16
!-----------------------------------------------                                  !SRFB 17
      character*11, parameter :: sysform = 'unformatted'                          !SRFB 18
      integer, parameter :: ndust = 5                                             !SRFB 19
      integer, parameter :: nbl = 3                                               !SRFB 20
      integer, parameter :: nlat = 25                                             !SRFB 21
!-----------------------------------------------                                  !SRFB 22
!   L o c a l   V a r i a b l e s                                                 !SRFB 23
!-----------------------------------------------                                  !SRFB 24
      integer :: lastls, ilatstep, m, ier0, lsea, ls, lat1, lat2, lat, i, k, &    !SRFB 25
         lon1, lon2, lon, ils, jlon                                               !SRFB 26
      real(double) :: xlat, ylat, tsa0, tsa1, tsp1, tsa2, tsp2, usa0, usa1,  &    !SRFB 27
         usp1, usa2, usp2, vsa0, vsa1, vsp1, vsa2, vsp2                           !SRFB 28
      character , dimension(ndust) :: dust*2                                      !SRFB 29
      character :: dummy*2                                                        !SRFB 30
!-----------------------------------------------                                  !SRFB 31
!...    Set parameter for "form=" in binary file Open statement                   !SRFB 32
!...    Set character values of dust optical depths used in file names            !SRFB 33
      data dust/ '03', '10', '30', 'y1', 'y2'/                                    !SRFB 34
!...    Initialize last Ls processed to zero                                      !SRFB 35
      lastls = 0                                                                  !SRFB 36
!...    Compute latitude step size                                                !SRFB 37
      ilatstep = 1800/(nlat - 1)                                                  !SRFB 38
!...    Step through all dust optical depths                                      !SRFB 39
      do m = 1, ndust                                                             !SRFB 40
!...      Open ASCII version and binary version data files at 5m and              !SRFB 41
!         30m levels                                                              !SRFB 42
         ier0 = 0                                                                 !SRFB 43
         open(23, file='sfc00'//dust(m)//version//'.txt', status='old', err=1, &  !SRFB 44
            position='asis')                                                      !SRFB 45
         open(26, file='sfc00'//dust(m)//version//'.bin', form=sysform, err=99 &  !SRFB 46
            , position='asis')                                                    !SRFB 47
         go to 2                                                                  !SRFB 48
    1    continue                                                                 !SRFB 49
         write (*, *) ' sfc00 files not available for optical depth= ', dust(m)   !SRFB 50
         ier0 = 1                                                                 !SRFB 51
    2    continue                                                                 !SRFB 52
         open(24, file='sfc05'//dust(m)//version//'.txt', status='old', err=99 &  !SRFB 53
            , position='asis')                                                    !SRFB 54
         open(25, file='sfc30'//dust(m)//version//'.txt', status='old', err=99 &  !SRFB 55
            , position='asis')                                                    !SRFB 56
         open(27, file='sfc05'//dust(m)//version//'.bin', form=sysform, err=99 &  !SRFB 57
            , position='asis')                                                    !SRFB 58
         open(28, file='sfc30'//dust(m)//version//'.bin', form=sysform, err=99 &  !SRFB 59
            , position='asis')                                                    !SRFB 60
!...      Read (and ignore) the header line from the ASCII files                  !SRFB 61
         if (ier0 == 0) read (23, 10) dummy                                       !SRFB 62
         read (24, 10) dummy                                                      !SRFB 63
         read (25, 10) dummy                                                      !SRFB 64
   10    format(a)                                                                !SRFB 65
!...      Step through all Ls values                                              !SRFB 66
         do lsea = 30, 360, 30                                                    !SRFB 67
            ls = lsea/30                                                          !SRFB 68
!...      Step through all latitudes                                              !SRFB 69
            lat1 = -900                                                           !SRFB 70
            lat2 = 900                                                            !SRFB 71
            do lat = lat1, lat2, ilatstep                                         !SRFB 72
               xlat = lat/10.0D0                                                  !SRFB 73
               i = 1 + (lat + 900)/ilatstep                                       !SRFB 74
!...      Step through all boundary layer levels                                  !SRFB 75
               if (ier0 /= 0) then                                                !SRFB 76
                  do k = 1, nbl                                                   !SRFB 77
!...      Step through all longitudes                                             !SRFB 78
                     lon1 = 360                                                   !SRFB 79
                     lon2 = 9                                                     !SRFB 80
                     if (k == 1) then                                             !SRFB 81
                     else                                                         !SRFB 82
                        do lon = lon1, lon2, -9                                   !SRFB 83
!...        Read ASCII version tide coefficient amplitudes and phases             !SRFB 84
!           for temperature, EW wind, and NS wind                                 !SRFB 85
                           read (22 + k, *, end=60) ils, ylat, jlon, tsa0, tsa1 & !SRFB 86
                              , tsp1, tsa2, tsp2, usa0, usa1, usp1, usa2, usp2  & !SRFB 87
                              , vsa0, vsa1, vsp1, vsa2, vsp2                      !SRFB 88
!...        Reset value of last Ls processed                                      !SRFB 89
                           lastls = ils                                           !SRFB 90
                           if (ils /= lsea) stop ' Bad surface Ls'                !SRFB 91
                           if (ylat /= xlat) stop ' Bad surface Latitude'         !SRFB 92
                           if (jlon /= lon) stop ' Bad surface Longitude'         !SRFB 93
!...        Write binary version tide amplitudes and phases for                   !SRFB 94
!           temperature, EW wind, and NS wind                                     !SRFB 95
                           write (25 + k) ils, ylat, jlon, tsa0, tsa1, tsp1,  &   !SRFB 96
                              tsa2, tsp2, usa0, usa1, usp1, usa2, usp2, vsa0, &   !SRFB 97
                              vsa1, vsp1, vsa2, vsp2                              !SRFB 98
                        end do                                                    !SRFB 99
                     endif                                                        !SRFB100
                  end do                                                          !SRFB101
               else                                                               !SRFB102
                  do k = 1, nbl                                                   !SRFB103
!...      Step through all longitudes                                             !SRFB104
                     lon1 = 360                                                   !SRFB105
                     lon2 = 9                                                     !SRFB106
                     if (k == 1) then                                             !SRFB107
!...        Write binary version tide amplitudes and phases for                   !SRFB108
!           temperature, EW wind, and NS wind                                     !SRFB109
                        do lon = lon1, lon2, -9                                   !SRFB110
!...        Read ASCII version tide coefficient amplitudes and phases             !SRFB111
!           for temperature, EW wind, and NS wind                                 !SRFB112
                           read (22 + k, *, end=60) ils, ylat, jlon, tsa0, tsa1 & !SRFB113
                              , tsp1, tsa2, tsp2                                  !SRFB114
!...        Reset value of last Ls processed                                      !SRFB115
                           lastls = ils                                           !SRFB116
                           if (ils /= lsea) stop ' Bad surface Ls'                !SRFB117
                           if (ylat /= xlat) stop ' Bad surface Latitude'         !SRFB118
                           if (jlon /= lon) stop ' Bad surface Longitude'         !SRFB119
!...        Write binary version tide amplitudes and phases for                   !SRFB120
!           temperature, EW wind, and NS wind                                     !SRFB121
                           write (25 + k) ils, ylat, jlon, tsa0, tsa1, tsp1,   &  !SRFB122
                              tsa2, tsp2                                          !SRFB123
                        end do                                                    !SRFB124
                     else                                                         !SRFB125
                        do lon = lon1, lon2, -9                                   !SRFB126
!...        Read ASCII version tide coefficient amplitudes and phases             !SRFB127
!           for temperature, EW wind, and NS wind                                 !SRFB128
                           read (22 + k, *, end=60) ils, ylat, jlon, tsa0, tsa1 & !SRFB129
                              , tsp1, tsa2, tsp2, usa0, usa1, usp1, usa2, usp2  & !SRFB130
                              , vsa0, vsa1, vsp1, vsa2, vsp2                      !SRFB131
!...        Reset value of last Ls processed                                      !SRFB132
                           lastls = ils                                           !SRFB133
                           if (ils /= lsea) stop ' Bad surface Ls'                !SRFB134
                           if (ylat /= xlat) stop ' Bad surface Latitude'         !SRFB135
                           if (jlon /= lon) stop ' Bad surface Longitude'         !SRFB136
!...        Write binary version tide amplitudes and phases for                   !SRFB137
!           temperature, EW wind, and NS wind                                     !SRFB138
                           write (25 + k) ils, ylat, jlon, tsa0, tsa1, tsp1,   &  !SRFB139
                              tsa2, tsp2, usa0, usa1, usp1, usa2, usp2, vsa0,  &  !SRFB140
                              vsa1, vsp1, vsa2, vsp2                              !SRFB141
                        end do                                                    !SRFB142
                     endif                                                        !SRFB143
                  end do                                                          !SRFB144
               endif                                                              !SRFB145
            end do                                                                !SRFB146
         end do                                                                   !SRFB147
         go to 70                                                                 !SRFB148
!...      Write termination message if premature EOF encountered                  !SRFB149
   60    continue                                                                 !SRFB150
         write (*, *) ' End of surface file at Ls =', lastls                      !SRFB151
!...      Close all MGCM surface data input files                                 !SRFB152
   70    continue                                                                 !SRFB153
         do i = 23, 28                                                            !SRFB154
            if (i==23 .and. ier0/=0) cycle                                        !SRFB155
            close(i)                                                              !SRFB156
         end do                                                                   !SRFB157
         cycle                                                                    !SRFB158
!...    Write warning message in case all dust optical depth values               !SRFB159
!       are not available for processing                                          !SRFB160
   99    continue                                                                 !SRFB161
         write (*, *) ' Files not available for dust optical depth= ', dust(m)    !SRFB162
      end do                                                                      !SRFB163
      return                                                                      !SRFB164
      end subroutine surfbin                                                      !SRFB165
                                                                                  !SRFB166
                                                                                  !SRFB167
!-------------------------------------------------------------------------------  !GCMB  1
      SUBROUTINE MGCMBIN(VERSION)                                                 !GCMB  2
!-----------------------------------------------                                  !GCMB  3
!   M o d u l e s                                                                 !GCMB  4
!-----------------------------------------------                                  !GCMB  5
      USE vast_kind_param, ONLY:  DOUBLE                                          !GCMB  6
!...    Reads ASCII version MGCM 0-80 km data and writes binary version           !GCMB  7
!...Translated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10        !GCMB  8
!...Switches:                                                                     !GCMB  9
      IMPLICIT NONE                                                               !GCMB 10
!-----------------------------------------------                                  !GCMB 11
!   D u m m y   A r g u m e n t s                                                 !GCMB 12
!-----------------------------------------------                                  !GCMB 13
      CHARACTER , INTENT(IN) :: VERSION                                           !GCMB 14
!-----------------------------------------------                                  !GCMB 15
!   L o c a l   P a r a m e t e r s                                               !GCMB 16
!-----------------------------------------------                                  !GCMB 17
      CHARACTER*11, PARAMETER :: SYSFORM = 'unformatted'                          !GCMB 18
      INTEGER, PARAMETER :: NDUST = 5                                             !GCMB 19
      INTEGER, PARAMETER :: NLAT = 25                                             !GCMB 20
!-----------------------------------------------                                  !GCMB 21
!   L o c a l   V a r i a b l e s                                                 !GCMB 22
!-----------------------------------------------                                  !GCMB 23
      INTEGER :: LASTLS, ILATSTEP, M, LSEA, LS, LAT1, LAT2, LAT, I, NHGT, K,    & !GCMB 24
         ILS, IHGT, KHGT                                                          !GCMB 25
      REAL(DOUBLE) :: XLAT, YLAT, TZA0, TZA1, TZP1, TZA2, TZP2, PZA0, PZA1,     & !GCMB 26
         PZP1, PZA2, PZP2, DZA0, DZA1, DZP1, DZA2, DZP2, UZA0, UZA1, UZP1, UZA2 & !GCMB 27
         , UZP2, VZA0, VZA1, VZP1, VZA2, VZP2                                     !GCMB 28
      CHARACTER , DIMENSION(NDUST) :: DUST*2                                      !GCMB 29
      CHARACTER :: DUMMY*2                                                        !GCMB 30
!-----------------------------------------------                                  !GCMB 31
!...    Set parameter for "form=" in binary file Open statement                   !GCMB 32
!...    Set character values of dust optical depths used in file names            !GCMB 33
      DATA DUST/ '03', '10', '30', 'y1', 'y2'/                                    !GCMB 34
!...    Initialize last Ls processed to zero                                      !GCMB 35
      LASTLS = 0                                                                  !GCMB 36
!...    Compute latitude step size                                                !GCMB 37
      ILATSTEP = 1800/(NLAT - 1)                                                  !GCMB 38
!...    Step through all dust optical depths                                      !GCMB 39
      DO M = 1, NDUST                                                             !GCMB 40
!...      Open ASCII version and binary version data files for temp-              !GCMB 41
!         erature, density, pressure and for EW and NS wind components            !GCMB 42
         OPEN(22, FILE='tpdlo'//DUST(M)//VERSION//'.txt', STATUS='old', ERR=99 &  !GCMB 43
            , POSITION='asis')                                                    !GCMB 44
         OPEN(23, FILE='uvlo'//DUST(M)//VERSION//'.txt', STATUS='old', ERR=99, &  !GCMB 45
            POSITION='asis')                                                      !GCMB 46
         OPEN(24, FILE='tpdlo'//DUST(M)//VERSION//'.bin', FORM=SYSFORM, ERR=99 &  !GCMB 47
            , POSITION='asis')                                                    !GCMB 48
         OPEN(25, FILE='uvlo'//DUST(M)//VERSION//'.bin', FORM=SYSFORM, ERR=99, &  !GCMB 49
            POSITION='asis')                                                      !GCMB 50
!...      Read (and ignore) the header line from the ASCII files                  !GCMB 51
         READ (22, 10) DUMMY                                                      !GCMB 52
         READ (23, 10) DUMMY                                                      !GCMB 53
   10    FORMAT(A)                                                                !GCMB 54
!...      Step through all Ls values                                              !GCMB 55
         DO LSEA = 30, 360, 30                                                    !GCMB 56
            LS = LSEA/30                                                          !GCMB 57
!...      Step through all latitudes                                              !GCMB 58
            LAT1 = -900                                                           !GCMB 59
            LAT2 = 900                                                            !GCMB 60
            DO LAT = LAT1, LAT2, ILATSTEP                                         !GCMB 61
               XLAT = LAT/10.0D0                                                  !GCMB 62
               I = 1 + (LAT + 900)/ILATSTEP                                       !GCMB 63
!...      Step through all heights                                                !GCMB 64
               NHGT = 17                                                          !GCMB 65
               IF (M > 3) NHGT = 30                                               !GCMB 66
               IF (M <= 3) THEN                                                   !GCMB 67
                  DO K = NHGT, 1, -1                                              !GCMB 68
!...        Read ASCII version tide coefficient amplitudes and phases             !GCMB 69
!           for temperature, pressure, and density                                !GCMB 70
                     READ (22, *, END=55) ILS, IHGT, YLAT, TZA0, TZA1, TZP1,   &  !GCMB 71
                        TZA2, TZP2, PZA0, PZA1, PZP1, PZA2, PZP2, DZA0            !GCMB 72
!...          Write binary version tide amplitudes and phases for                 !GCMB 73
!             temperature, pressure, and density                                  !GCMB 74
                     WRITE (24) ILS, IHGT, YLAT, TZA0, TZA1, TZP1, TZA2, TZP2, &  !GCMB 75
                        PZA0, PZA1, PZP1, PZA2, PZP2, DZA0                        !GCMB 76
!...          Write binary version tide amplitudes and phases for                 !GCMB 77
!             temperature, pressure, and density                                  !GCMB 78
                     IF (ILS /= LSEA) THEN                                        !GCMB 79
                        WRITE (*, *) LSEA, ILS, IHGT, YLAT                        !GCMB 80
                        STOP ' Bad tpd Ls'                                        !GCMB 81
                     ENDIF                                                        !GCMB 82
                     KHGT = 5*(K - 1)                                             !GCMB 83
                     IF (IHGT /= KHGT) STOP ' Bad tpd Height'                     !GCMB 84
                     IF (YLAT /= XLAT) STOP ' Bad tpd Latitude'                   !GCMB 85
!...        Read ASCII version tide coefficient amplitudes and phases             !GCMB 86
!           for EW wind and NS wind components                                    !GCMB 87
                     READ (23, *, END=55) ILS, IHGT, YLAT, UZA0, UZA1, UZP1,   &  !GCMB 88
                        UZA2, UZP2, VZA0, VZA1, VZP1, VZA2, VZP2                  !GCMB 89
!...        Reset value of last Ls processed                                      !GCMB 90
                     LASTLS = ILS                                                 !GCMB 91
!...        Write binary version tide amplitudes and phases for                   !GCMB 92
!           EW wind and NS wind components                                        !GCMB 93
                     WRITE (25) ILS, IHGT, YLAT, UZA0, UZA1, UZP1, UZA2, UZP2, &  !GCMB 94
                        VZA0, VZA1, VZP1, VZA2, VZP2                              !GCMB 95
                     IF (ILS /= LSEA) STOP ' Bad uv Ls'                           !GCMB 96
                     IF (IHGT /= KHGT) STOP ' Bad uv Height'                      !GCMB 97
                     IF (YLAT == XLAT) CYCLE                                      !GCMB 98
                     STOP ' Bad uv Latitude'                                      !GCMB 99
                  END DO                                                          !GCMB100
               ELSE                                                               !GCMB101
                  DO K = NHGT, 1, -1                                              !GCMB102
!...          Write binary version tide amplitudes and phases for                 !GCMB103
!             temperature, pressure, and density                                  !GCMB104
                     READ (22, *, END=55) ILS, IHGT, YLAT, TZA0, TZA1, TZP1,   &  !GCMB105
                        TZA2, TZP2, DZA0, DZA1, DZP1, DZA2, DZP2, PZA0            !GCMB106
!...          Write binary version tide amplitudes and phases for                 !GCMB107
!             temperature, pressure, and density                                  !GCMB108
                     WRITE (24) ILS, IHGT, YLAT, TZA0, TZA1, TZP1, TZA2, TZP2, &  !GCMB109
                        DZA0, DZA1, DZP1, DZA2, DZP2, PZA0                        !GCMB110
                     IF (ILS /= LSEA) THEN                                        !GCMB111
                        WRITE (*, *) LSEA, ILS, IHGT, YLAT                        !GCMB112
                        STOP ' Bad tpd Ls'                                        !GCMB113
                     ENDIF                                                        !GCMB114
                     KHGT = 5*(K - 1)                                             !GCMB115
                     KHGT = 5*(K - 14)                                            !GCMB116
                     IF (K < 16) KHGT = K - 6                                     !GCMB117
                     IF (IHGT /= KHGT) STOP ' Bad tpd Height'                     !GCMB118
                     IF (YLAT /= XLAT) STOP ' Bad tpd Latitude'                   !GCMB119
!...        Read ASCII version tide coefficient amplitudes and phases             !GCMB120
!           for EW wind and NS wind components                                    !GCMB121
                     READ (23, *, END=55) ILS, IHGT, YLAT, UZA0, UZA1, UZP1,   &  !GCMB122
                        UZA2, UZP2, VZA0, VZA1, VZP1, VZA2, VZP2                  !GCMB123
!...        Reset value of last Ls processed                                      !GCMB124
                     LASTLS = ILS                                                 !GCMB125
!...        Write binary version tide amplitudes and phases for                   !GCMB126
!           EW wind and NS wind components                                        !GCMB127
                     WRITE (25) ILS, IHGT, YLAT, UZA0, UZA1, UZP1, UZA2, UZP2, &  !GCMB128
                        VZA0, VZA1, VZP1, VZA2, VZP2                              !GCMB129
                     IF (ILS /= LSEA) STOP ' Bad uv Ls'                           !GCMB130
                     IF (IHGT /= KHGT) STOP ' Bad uv Height'                      !GCMB131
                     IF (YLAT == XLAT) CYCLE                                      !GCMB132
                     STOP ' Bad uv Latitude'                                      !GCMB133
                  END DO                                                          !GCMB134
               ENDIF                                                              !GCMB135
            END DO                                                                !GCMB136
         END DO                                                                   !GCMB137
         GO TO 57                                                                 !GCMB138
!...      Write termination message if premature EOF encountered                  !GCMB139
   55    CONTINUE                                                                 !GCMB140
         WRITE (*, *) ' End of file on 0-80 km at Ls=', LASTLS                    !GCMB141
!...      Close all MGCM 0-80 km data input files                                 !GCMB142
   57    CONTINUE                                                                 !GCMB143
         DO I = 22, 25                                                            !GCMB144
            CLOSE(I)                                                              !GCMB145
         END DO                                                                   !GCMB146
         CYCLE                                                                    !GCMB147
!...    Write warning message in case all dust optical depth values               !GCMB148
!       are not available for processing                                          !GCMB149
   99    CONTINUE                                                                 !GCMB150
         WRITE (*, *) ' Files not available for dust optical depth=', DUST(M)     !GCMB151
      END DO                                                                      !GCMB152
      RETURN                                                                      !GCMB153
      END SUBROUTINE MGCMBIN                                                      !GCMB154
                                                                                  !GCMB155
                                                                                  !GCMB156
!-----------------------------------------------------------------------          !TGMB  1
      SUBROUTINE MTGCMBIN(VERSION)                                                !TGMB  2
!-----------------------------------------------                                  !TGMB  3
!   M o d u l e s                                                                 !TGMB  4
!-----------------------------------------------                                  !TGMB  5
      USE vast_kind_param, ONLY:  DOUBLE                                          !TGMB  6
!...    Reads ASCII version MTGCM 80-240 km data and writes binary                !TGMB  7
!       version                                                                   !TGMB  8
!...Translated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10        !TGMB  9
!...Switches:                                                                     !TGMB 10
      IMPLICIT NONE                                                               !TGMB 11
!-----------------------------------------------                                  !TGMB 12
!   D u m m y   A r g u m e n t s                                                 !TGMB 13
!-----------------------------------------------                                  !TGMB 14
      CHARACTER , INTENT(IN) :: VERSION                                           !TGMB 15
!-----------------------------------------------                                  !TGMB 16
!   L o c a l   P a r a m e t e r s                                               !TGMB 17
!-----------------------------------------------                                  !TGMB 18
      CHARACTER*11, PARAMETER :: SYSFORM = 'unformatted'                          !TGMB 19
      INTEGER, PARAMETER :: NDUST = 5                                             !TGMB 20
      INTEGER, PARAMETER :: NLATT = 36                                            !TGMB 21
!-----------------------------------------------                                  !TGMB 22
!   L o c a l   V a r i a b l e s                                                 !TGMB 23
!-----------------------------------------------                                  !TGMB 24
      INTEGER :: LASTLS, M, NF10, N, LSEA, LS, ILAT, NHGTT, K, ILS, IHGT, I       !TGMB 25
      REAL(DOUBLE) :: YLAT, TZA0, TZA1, TZP1, TZA2, TZP2, PZA0, PZA1, PZP1,     & !TGMB 26
         PZA2, PZP2, DZA0, DZA1, DZP1, DZA2, DZP2, UZA0, UZA1, UZP1, UZA2, UZP2 & !TGMB 27
         , VZA0, VZA1, VZP1, VZA2, VZP2                                           !TGMB 28
      CHARACTER , DIMENSION(NDUST) :: DUST*2                                      !TGMB 29
      CHARACTER :: DUMMY*2                                                        !TGMB 30
      CHARACTER, DIMENSION(3) :: SOLACT*2                                         !TGMB 31
!-----------------------------------------------                                  !TGMB 32
!...    Set parameter for "form=" in binary file Open statement                   !TGMB 33
!...    Set character values of dust optical depths used in file names            !TGMB 34
      DATA DUST/ '03', '10', '30', 'y1', 'y2'/                                    !TGMB 35
!...    Set characters for solar activity values used in file names               !TGMB 36
      DATA SOLACT/ 'ls', 'ms', 'hs'/                                              !TGMB 37
!...    Initialize last Ls processed to zero                                      !TGMB 38
      LASTLS = 0                                                                  !TGMB 39
!...    Step through all dust optical depths and solar activities                 !TGMB 40
      DO M = 1, NDUST                                                             !TGMB 41
         NF10 = 2                                                                 !TGMB 42
         IF (M > 3) NF10 = 3                                                      !TGMB 43
         DO N = 1, NF10                                                           !TGMB 44
!...      Open ASCII version and binary version data files for temp-              !TGMB 45
!         erature, density, pressure and for EW and NS wind components            !TGMB 46
            OPEN(22, FILE='tpd'//SOLACT(N)//DUST(M)//VERSION//'.txt', STATUS=  &  !TGMB 47
               'old', ERR=99, POSITION='asis')                                    !TGMB 48
            OPEN(23, FILE='uv'//SOLACT(N)//DUST(M)//VERSION//'.txt', STATUS=   &  !TGMB 49
               'old', ERR=99, POSITION='asis')                                    !TGMB 50
            OPEN(24, FILE='tpd'//SOLACT(N)//DUST(M)//VERSION//'.bin', FORM=    &  !TGMB 51
               SYSFORM, ERR=99, POSITION='asis')                                  !TGMB 52
            OPEN(25, FILE='uv'//SOLACT(N)//DUST(M)//VERSION//'.bin', FORM=     &  !TGMB 53
               SYSFORM, ERR=99, POSITION='asis')                                  !TGMB 54
!...      Read (and ignore) the header line from the ASCII files                  !TGMB 55
            READ (22, 10) DUMMY                                                   !TGMB 56
            READ (23, 10) DUMMY                                                   !TGMB 57
   10       FORMAT(A)                                                             !TGMB 58
!...      Step through all Ls values                                              !TGMB 59
            DO LSEA = 30, 360, 30                                                 !TGMB 60
               LS = LSEA/30                                                       !TGMB 61
!...      Step through all latitudes                                              !TGMB 62
               DO ILAT = 1, NLATT                                                 !TGMB 63
!...      Step through all heights                                                !TGMB 64
                  NHGTT = 19                                                      !TGMB 65
                  IF (M > 3) NHGTT = 33                                           !TGMB 66
                  DO K = 1, NHGTT                                                 !TGMB 67
!...        Read ASCII version tide coefficient amplitudes and phases             !TGMB 68
!           for temperature, pressure, and density                                !TGMB 69
                     READ (22, *, END=55) ILS, IHGT, YLAT, TZA0, TZA1, TZP1,  &   !TGMB 70
                        TZA2, TZP2, PZA0, PZA1, PZP1, PZA2, PZP2, DZA0, DZA1, &   !TGMB 71
                        DZP1, DZA2, DZP2                                          !TGMB 72
!...        Write binary version tide amplitudes and phases for                   !TGMB 73
!           temperature, pressure, and density                                    !TGMB 74
                     WRITE (24) ILS, IHGT, YLAT, TZA0, TZA1, TZP1, TZA2, TZP2, &  !TGMB 75
                        PZA0, PZA1, PZP1, PZA2, PZP2, DZA0, DZA1, DZP1, DZA2,  &  !TGMB 76
                        DZP2                                                      !TGMB 77
                     IF (ILS /= LSEA) THEN                                        !TGMB 78
                        WRITE (*, *) ' dust,Ls,hgt,lat=', DUST(M), ILS, IHGT,  &  !TGMB 79
                           YLAT                                                   !TGMB 80
                        STOP ' Bad tpd Ls'                                        !TGMB 81
                     ENDIF                                                        !TGMB 82
                     IF (IHGT /= 80 + 5*(K - 1)) THEN                             !TGMB 83
                        WRITE (*, *) ' sol,dust,ils,k,ihgt,nhgtt=', SOLACT(N), &  !TGMB 84
                           DUST(M), ILS, K, IHGT, NHGTT                           !TGMB 85
                        STOP ' Bad tpd Height'                                    !TGMB 86
                     ENDIF                                                        !TGMB 87
!...        Read ASCII version tide coefficient amplitudes and phases             !TGMB 88
!           for EW wind and NS wind components                                    !TGMB 89
                     READ (23, *, END=55) ILS, IHGT, YLAT, UZA0, UZA1, UZP1,   &  !TGMB 90
                        UZA2, UZP2, VZA0, VZA1, VZP1, VZA2, VZP2                  !TGMB 91
!...        Reset value of last Ls processed                                      !TGMB 92
                     LASTLS = ILS                                                 !TGMB 93
!...        Write binary version tide amplitudes and phases for                   !TGMB 94
!           EW wind and NS wind components                                        !TGMB 95
                     WRITE (25) ILS, IHGT, YLAT, UZA0, UZA1, UZP1, UZA2, UZP2, &  !TGMB 96
                        VZA0, VZA1, VZP1, VZA2, VZP2                              !TGMB 97
                     IF (ILS /= LSEA) STOP ' Bad uv Ls'                           !TGMB 98
                     IF (IHGT == 80 + 5*(K - 1)) CYCLE                            !TGMB 99
                     STOP ' Bad uv Height'                                        !TGMB100
                  END DO                                                          !TGMB101
               END DO                                                             !TGMB102
            END DO                                                                !TGMB103
            GO TO 57                                                              !TGMB104
!...      Write termination message if premature EOF encountered                  !TGMB105
   55       CONTINUE                                                              !TGMB106
            WRITE (*, *) ' End of file on 85-240 km at Ls=', LASTLS               !TGMB107
!...      Close all MTGCM 80-240 km data input files                              !TGMB108
   57       CONTINUE                                                              !TGMB109
            DO I = 22, 25                                                         !TGMB110
               CLOSE(I)                                                           !TGMB111
            END DO                                                                !TGMB112
            CYCLE                                                                 !TGMB113
!...    Write warning message in case all dust optical depth values               !TGMB114
!       are not available for processing                                          !TGMB115
   99       CONTINUE                                                              !TGMB116
            WRITE (*, *) ' Files not available for dust optical depth=',DUST(M)   !TGMB117
         END DO                                                                   !TGMB119
      END DO                                                                      !TGMB120
      RETURN                                                                      !TGMB121
      END SUBROUTINE MTGCMBIN                                                     !TGMB122
                                                                                  !TGMB123
                                                                                  !TGMB124
!-------------------------------------------------------------------------------  !DSTB  1
      subroutine dustbin(version)                                                 !DSTB  2
!-----------------------------------------------                                  !DSTB  3
!   M o d u l e s                                                                 !DSTB  4
!-----------------------------------------------                                  !DSTB  5
      USE vast_kind_param, ONLY:  double                                          !DSTB  6
!...    Reads ASCII TES dust optical depths; write binary version                 !DSTB  7
!...Translated by Pacific-Sierra Research 77to90  4.4G  10:02:23  03/23/10        !DSTB  8
!...Switches:                                                                     !DSTB  9
      implicit none                                                               !DSTB 10
!-----------------------------------------------                                  !DSTB 11
!   D u m m y   A r g u m e n t s                                                 !DSTB 12
!-----------------------------------------------                                  !DSTB 13
      character , intent(in) :: version                                           !DSTB 14
!-----------------------------------------------                                  !DSTB 15
!   L o c a l   P a r a m e t e r s                                               !DSTB 16
!-----------------------------------------------                                  !DSTB 17
      character*11, parameter :: sysform = 'unformatted'                          !DSTB 18
      integer, parameter :: ntesyr = 2                                            !DSTB 19
      integer, parameter :: ntesls = 72                                           !DSTB 20
      integer, parameter :: nlat = 25                                             !DSTB 21
      integer, parameter :: nlon = 40                                             !DSTB 22
!-----------------------------------------------                                  !DSTB 23
!   L o c a l   V a r i a b l e s                                                 !DSTB 24
!-----------------------------------------------                                  !DSTB 25
      integer :: iyear, ils, lat, lon, iyr                                        !DSTB 26
      real(double), dimension(ntesyr,ntesls,nlat,0:nlon) :: testau                !DSTB 27
      real(double) :: steplat, ylat1, steplon, stepls, xls, ylat, ylon, als,    & !DSTB 28
         xlat, xlon, dust                                                         !DSTB 29
      character :: dummy                                                          !DSTB 30
!-----------------------------------------------                                  !DSTB 31
!...    Set parameter for "form=" in binary file Open statement                   !DSTB 32
!...    Open input and output files for dust data                                 !DSTB 33
      open(23, file='TESdust'//version//'.txt', status='old', err=99, position= & !DSTB 34
         'asis')                                                                  !DSTB 35
      open(24, file='TESdust'//version//'.bin', form=sysform, err=99, position= & !DSTB 36
         'asis')                                                                  !DSTB 37
      read (23, 10) dummy                                                         !DSTB 38
   10 format(a1)                                                                  !DSTB 39
!...    Latitude step, based on number of lats                                    !DSTB 40
      steplat = 180.0D0/(nlat - 1)                                                !DSTB 41
      ylat1 = (-90.0D0) - steplat                                                 !DSTB 42
!...    Longitude step, based on number of longitudes                             !DSTB 43
      steplon = 360.0D0/nlon                                                      !DSTB 44
!...    Ls step, based on number of Ls's                                          !DSTB 45
      stepls = 360.0/ntesls                                                       !DSTB 46
!...    Step through TES years                                                    !DSTB 47
      do iyear = 1, 2                                                             !DSTB 48
!...    Step through Ls values                                                    !DSTB 49
         do ils = 1, ntesls                                                       !DSTB 50
            xls = (-stepls/2.0) + stepls*ils                                      !DSTB 51
!...    Step through latitudes                                                    !DSTB 52
            do lat = 1, nlat                                                      !DSTB 53
               ylat = ylat1 + steplat*lat                                         !DSTB 54
!...    Step through longitudes                                                   !DSTB 55
               do lon = nlon, 1, -1                                               !DSTB 56
                  ylon = steplon*lon                                              !DSTB 57
!...      Read a line from ASCII format file                                      !DSTB 58
                  read (23, *) iyr, als, xlat, xlon, dust                         !DSTB 59
!...      Ceck input data; stop if error encountered                              !DSTB 60
                  if (iyear /= iyr) stop ' Bad TES dust year'                     !DSTB 61
                  if (dabs(xls - als) > 0.01D0) then                              !DSTB 62
                     write (*, *) ils, xls, als                                   !DSTB 63
                     stop ' Bad TES dust Ls'                                      !DSTB 64
                  endif                                                           !DSTB 65
                  if (dabs(xlat - ylat) > 0.01D0) stop ' Bad TES dust latitude'   !DSTB 66
                  if (dabs(ylon - xlon) > 0.01D0) stop &                          !DSTB 67
                     ' Bad TES dust longitude'                                    !DSTB 68
!...      Store dust optical depth value in array                                 !DSTB 69
                  testau(iyear,ils,lat,lon) = dust                                !DSTB 70
               end do                                                             !DSTB 71
!...    Set longitude = 0 value to longitude = 360 value                          !DSTB 72
               testau(iyear,ils,lat,0) = testau(iyear,ils,lat,nlon)               !DSTB 73
            end do                                                                !DSTB 74
         end do                                                                   !DSTB 75
      end do                                                                      !DSTB 76
!...    Write binary array to output file                                         !DSTB 77
      write (24) testau                                                           !DSTB 78
      go to 100                                                                   !DSTB 79
   99 continue                                                                    !DSTB 80
      write (*, *) ' I/O Files not available for TES dust data'                   !DSTB 81
  100 continue                                                                    !DSTB 82
      return                                                                      !DSTB 83
      end subroutine dustbin                                                      !DSTB 84
!-------------------------------------------------------------------------------  !DSTB 85
