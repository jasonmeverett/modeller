      module vast_kind_param                                                      !VAST  1
         integer, parameter :: byte_log = selected_int_kind(2)                    !VAST  2
         integer, parameter :: short_log = selected_int_kind(4)                   !VAST  3
         integer, parameter :: long_log = selected_int_kind(18)                   !VAST  4
         integer, parameter :: byte = selected_int_kind(2)                        !VAST  5
         integer, parameter :: short = selected_int_kind(4)                       !VAST  6
         integer, parameter :: long = selected_int_kind(18)                       !VAST  7
         integer, parameter :: double = selected_real_kind(14)                    !VAST  8
         integer, parameter :: extended = selected_real_kind(30)                  !VAST  9
         integer, parameter :: double_ext = selected_real_kind(50)                !VAST 10
         integer, parameter :: dble_complex = selected_real_kind(14)              !VAST 11
         integer, parameter :: ext_complex = selected_real_kind(30)               !VAST 12
      end module vast_kind_param                                                  !VAST 13
!============================================================================     !VAST 14
      MODULE chkdt_I                                                              !VAST 15
      INTERFACE                                                                   !VAST 16
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 17
      SUBROUTINE chkdt (MYEAR, MONTH, IDAY, IHOUR, MINUTES, SEC, ERR)             !VAST 18
      USE vast_kind_param,ONLY: DOUBLE                                            !VAST 19
      integer, INTENT(INOUT) :: MYEAR                                             !VAST 20
      integer, INTENT(IN) :: MONTH                                                !VAST 21
      integer, INTENT(IN) :: IDAY                                                 !VAST 22
      integer, INTENT(IN) :: IHOUR                                                !VAST 23
      integer, INTENT(IN) :: MINUTES                                              !VAST 24
      real(DOUBLE), INTENT(IN) :: SEC                                             !VAST 25
      integer, INTENT(OUT) :: ERR                                                 !VAST 26
!...This routine performs I/O.                                                    !VAST 27
      END SUBROUTINE                                                              !VAST 28
      END INTERFACE                                                               !VAST 29
      END MODULE                                                                  !VAST 30
!============================================================================     !VAST 31
      MODULE caltojul_I                                                           !VAST 32
      INTERFACE                                                                   !VAST 33
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 34
      SUBROUTINE caltojul (IY, IM, ID, IHOUR, IMIN, SEC, XJD)                     !VAST 35
      USE vast_kind_param,ONLY: DOUBLE                                            !VAST 36
      integer, INTENT(IN) :: IY                                                   !VAST 37
      integer, INTENT(IN) :: IM                                                   !VAST 38
      integer, INTENT(IN) :: ID                                                   !VAST 39
      integer, INTENT(IN) :: IHOUR                                                !VAST 40
      integer, INTENT(IN) :: IMIN                                                 !VAST 41
      real(DOUBLE), INTENT(IN) :: SEC                                             !VAST 42
      real(DOUBLE), INTENT(OUT) :: XJD                                            !VAST 43
      END SUBROUTINE                                                              !VAST 44
      END INTERFACE                                                               !VAST 45
      END MODULE                                                                  !VAST 46
!============================================================================     !VAST 47
      MODULE namemonth_I                                                          !VAST 48
      INTERFACE                                                                   !VAST 49
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 50
      SUBROUTINE namemonth (MONTH, MONTHNAME)                                     !VAST 51
      INTEGER, INTENT(IN) :: MONTH                                                !VAST 52
      CHARACTER (LEN = 3), INTENT(OUT) :: MONTHNAME                               !VAST 53
      END SUBROUTINE                                                              !VAST 54
      END INTERFACE                                                               !VAST 55
      END MODULE                                                                  !VAST 56
!============================================================================     !VAST 57
      MODULE marsephm_I                                                           !VAST 58
      INTERFACE                                                                   !VAST 59
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 60
      SUBROUTINE marsephm (XDAY, SUNLAT, SUNLON, SUNLSUBS, RADIUS, OWLT, EOT)     !VAST 61
      USE vast_kind_param,ONLY: DOUBLE                                            !VAST 62
      real(DOUBLE), INTENT(IN) :: XDAY                                            !VAST 63
      real(DOUBLE), INTENT(OUT) :: SUNLAT                                         !VAST 64
      real(DOUBLE), INTENT(OUT) :: SUNLON                                         !VAST 65
      real(DOUBLE), INTENT(OUT) :: SUNLSUBS                                       !VAST 66
      real(DOUBLE), INTENT(OUT) :: RADIUS                                         !VAST 67
      real(DOUBLE), INTENT(OUT) :: OWLT                                           !VAST 68
      real(DOUBLE), INTENT(OUT) :: EOT                                            !VAST 69
!VAST...Calls: PERTURB, RESCALE, SHIFTDIF                                         !VAST 70
      END SUBROUTINE                                                              !VAST 71
      END INTERFACE                                                               !VAST 72
      END MODULE                                                                  !VAST 73
!============================================================================     !VAST 74
      MODULE jultocal_I                                                           !VAST 75
      INTERFACE                                                                   !VAST 76
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 77
      SUBROUTINE jultocal (JD, YEAR, MONTH, DAY, DAYFRAC)                         !VAST 78
      USE vast_kind_param,ONLY: DOUBLE                                            !VAST 79
      REAL(DOUBLE), INTENT(IN) :: JD                                              !VAST 80
      INTEGER, INTENT(OUT) :: YEAR                                                !VAST 81
      INTEGER, INTENT(INOUT) :: MONTH                                             !VAST 82
      INTEGER, INTENT(OUT) :: DAY                                                 !VAST 83
      REAL(DOUBLE), INTENT(OUT) :: DAYFRAC                                        !VAST 84
      END SUBROUTINE                                                              !VAST 85
      END INTERFACE                                                               !VAST 86
      END MODULE                                                                  !VAST 87
!============================================================================     !VAST 88
      MODULE perturb_I                                                            !VAST 89
      INTERFACE                                                                   !VAST 90
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST 91
      SUBROUTINE perturb (DT, PBS)                                                !VAST 92
      USE vast_kind_param,ONLY: DOUBLE                                            !VAST 93
      real(DOUBLE), INTENT(IN) :: DT                                              !VAST 94
      real(DOUBLE), INTENT(OUT) :: PBS                                            !VAST 95
      END SUBROUTINE                                                              !VAST 96
      END INTERFACE                                                               !VAST 97
      END MODULE                                                                  !VAST 98
!============================================================================     !VAST 99
      MODULE rescale_I                                                            !VAST100
      INTERFACE                                                                   !VAST101
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST102
      SUBROUTINE rescale (X)                                                      !VAST103
      USE vast_kind_param,ONLY: DOUBLE                                            !VAST104
      real(DOUBLE), INTENT(INOUT) :: X                                            !VAST105
      END SUBROUTINE                                                              !VAST106
      END INTERFACE                                                               !VAST107
      END MODULE                                                                  !VAST108
!============================================================================     !VAST109
      MODULE shiftdif_I                                                           !VAST110
      INTERFACE                                                                   !VAST111
!...Generated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10         !VAST112
      SUBROUTINE shiftdif (X)                                                     !VAST113
      USE vast_kind_param,ONLY: DOUBLE                                            !VAST114
      real(DOUBLE), INTENT(INOUT) :: X                                            !VAST115
      END SUBROUTINE                                                              !VAST116
      END INTERFACE                                                               !VAST117
      END MODULE                                                                  !VAST118
!============================================================================     !VAST119
      program main                                                                !FNDA  1
!-----------------------------------------------                                  !FNDA  2
!   M o d u l e s                                                                 !FNDA  3
!-----------------------------------------------                                  !FNDA  4
      USE vast_kind_param, ONLY:  double                                          !FNDA  5
!...  Program to find date and time for a desired Mars areocentric                !FNDA  6
!     solar longitude (Ls) and date and time for a desired Mars local             !FNDA  7
!     true solar time (LTST) at a given Mars site longitude.                      !FNDA  8
!......................................................................           !FNDA  9
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !FNDA 10
!...Switches:                                                                     !FNDA 11
!-----------------------------------------------                                  !FNDA 12
!   I n t e r f a c e   B l o c k s                                               !FNDA 13
!-----------------------------------------------                                  !FNDA 14
      use chkdt_I                                                                 !FNDA 15
      use namemonth_I                                                             !FNDA 16
      use caltojul_I                                                              !FNDA 17
      use marsephm_I                                                              !FNDA 18
      use jultocal_I                                                              !FNDA 19
      implicit none                                                               !FNDA 20
!-----------------------------------------------                                  !FNDA 21
!   L o c a l   V a r i a b l e s                                                 !FNDA 22
!-----------------------------------------------                                  !FNDA 23
      integer :: myear, lonew, iutc, iert, month, iday, ihour, minutes, m,  &     !FNDA 24
         icontinue, n, ierr                                                       !FNDA 25
      real(double) :: day, day0, rate, time, dls, xls, yls, lonout, latsun, &     !FNDA 26
         lonsun, radius, lonsite, xlst, ylst, dlst, dayrate, owlt, eot, dt, &     !FNDA 27
         ttsec, sec                                                               !FNDA 28
      character :: name*3, time1*3, ew, time2*2                                   !FNDA 29
!-----------------------------------------------                                  !FNDA 30
!...  Ls rate = Earth days/Ls degree = Mars tropical year (days)/360              !FNDA 31
      rate = 6.869726D2/3.6D2                                                     !FNDA 32
!...  LTST dayrate = Earth hrs/Mars hr = Mars day length (in hrs)/24              !FNDA 33
      dayrate = 24.6597D0/24.0D0                                                  !FNDA 34
!......................................................................           !FNDA 35
!                                                                                 !FNDA 36
!     User provides starting date and time.  This may be an arbitrary             !FNDA 37
!     value e.g. January 1, 00:00:00 on a given year, just to set the             !FNDA 38
!     year for which Ls and LTST are to be calculated.  The starting              !FNDA 39
!     date and time may also be any specific time for which the user              !FNDA 40
!     wants to compute the Ls or LTST, using the Mars ephemeris                   !FNDA 41
!     subroutine.  The year given may be any (4-digit) year 1970-2069             !FNDA 42
!                                                                                 !FNDA 43
!     Note: The program computes the next subsequent occurrence of                !FNDA 44
!     desired Ls after the start date.  If the user desires an                    !FNDA 45
!     occurrence of Ls before the start date used, the program should             !FNDA 46
!     be re-run, using an earlier start date.  LTST calculated is                 !FNDA 47
!     nearest occurrence to the date/time of the desired Ls occurence.            !FNDA 48
!                                                                                 !FNDA 49
!     An option is provided whereby the user can select either West               !FNDA 50
!     longitude or East longitude for specifying the Mars site                    !FNDA 51
!     location for which LTST is desired.                                         !FNDA 52
!                                                                                 !FNDA 53
!     This program uses the Allison Mars ephemeris subroutine                     !FNDA 54
!     to compute Ls and solar longitude.  RMS accuracy of both is about           !FNDA 55
!     0.004 degrees.  RMS accuracy of LTST is approximately 1 second.             !FNDA 56
!                                                                                 !FNDA 57
!     Options allow time to be expressed in either Terrestrial                    !FNDA 58
!     Dynamical Time (TT) or Coordinated Universal Time (UTC) and in              !FNDA 59
!     either Mars-Event (ME) time or Earth-Receive (ER) time.                     !FNDA 60
!                                                                                 !FNDA 61
!......................................................................           !FNDA 62
!                                                                                 !FNDA 63
    1 continue                                                                    !FNDA 64
      write (*, *) ' Enter 0 for West Longitude, 1 for East Longitude'            !FNDA 65
      read (*, *) lonew                                                           !FNDA 66
      if (lonew<0 .or. lonew>1) then                                              !FNDA 67
         write (*, *) ' Must enter 0 or 1'                                        !FNDA 68
         go to 1                                                                  !FNDA 69
      endif                                                                       !FNDA 70
      ew = 'W'                                                                    !FNDA 71
      if (lonew == 1) ew = 'E'                                                    !FNDA 72
    4 continue                                                                    !FNDA 73
      write (*, *) ' Enter 0 for Terrestrial Dynamical Time, 1 for UTC'           !FNDA 74
      read (*, *) iutc                                                            !FNDA 75
      if (iutc<0 .or. iutc>1) then                                                !FNDA 76
         write (*, *) ' Must enter 0 or 1'                                        !FNDA 77
         go to 4                                                                  !FNDA 78
      endif                                                                       !FNDA 79
      time1 = ' TT'                                                               !FNDA 80
      if (iutc == 1) time1 = 'UTC'                                                !FNDA 81
    5 continue                                                                    !FNDA 82
      write (*, *) ' Enter 0 for Mars Event time, 1 for Earth Receive', ' time'   !FNDA 83
      read (*, *) iert                                                            !FNDA 84
      if (iert<0 .or. iert>1) then                                                !FNDA 85
         write (*, *) ' Must enter 0 or 1'                                        !FNDA 86
         go to 5                                                                  !FNDA 87
      endif                                                                       !FNDA 88
      time2 = 'ME'                                                                !FNDA 89
      if (iert == 1) time2 = 'ER'                                                 !FNDA 90
    2 continue                                                                    !FNDA 91
      write (*, 3)                                                                !FNDA 92
    3 format(' Enter start year, month, day, hour, minute, seconds,',      &      !FNDA 93
         ' and desired Ls (deg)')                                                 !FNDA 94
      read (*, *) myear, month, iday, ihour, minutes, sec, xls                    !FNDA 95
!...  Check date and time input                                                   !FNDA 96
      call chkdt (myear, month, iday, ihour, minutes, sec, ierr)                  !FNDA 97
      if (ierr < (-6)) then                                                       !FNDA 98
         write (*, *) ' CHKDT detected TIME error condition'                      !FNDA 99
      else if (ierr < 0) then                                                     !FNDA100
         write (*, *) ' CHKDT detected DATE error condition'                      !FNDA101
      endif                                                                       !FNDA102
!...  Check Ls input                                                              !FNDA103
      if (xls<0.0D0 .or. xls>3.6D2) then                                          !FNDA104
         write (*, *) ' Ls must be 0-360'                                         !FNDA105
         ierr = -10                                                               !FNDA106
      endif                                                                       !FNDA107
      if (ierr < 0) go to 2                                                       !FNDA108
!...  Get month name from month                                                   !FNDA109
      call namemonth (month, name)                                                !FNDA110
    6 continue                                                                    !FNDA111
      write (*, *) ' Enter Mars Site Longitude (deg), and desired Local',  &      !FNDA112
         ' True Solar Time (hr)'                                                  !FNDA113
      read (*, *) lonsite, xlst                                                   !FNDA114
      if (dabs(lonsite) > 3.6D2) then                                             !FNDA115
         write (*, *) ' Longitude must be -360 to +360'                           !FNDA116
         go to 6                                                                  !FNDA117
      endif                                                                       !FNDA118
      lonout = lonsite                                                            !FNDA119
!...  Convert to West longitude if necessary                                      !FNDA120
      if (lonew == 1) lonsite = 3.6D2 - lonsite                                   !FNDA121
      if (xlst<0.0D0 .or. xlst>2.4D1) then                                        !FNDA122
         write (*, *) ' Local Time must be 0-24'                                  !FNDA123
         go to 6                                                                  !FNDA124
      endif                                                                       !FNDA125
!...  Get initial Julian day (DAY0)                                               !FNDA126
      call caltojul (myear, month, iday, ihour, minutes, sec, day0)               !FNDA127
      ttsec = 0.0D0                                                               !FNDA128
      if (iutc == 1) then                                                         !FNDA129
!...    Get terrestrial dynamical time offset (seconds)                           !FNDA130
         dt = (myear - 2000.0D0)/100.0D0                                          !FNDA131
!...    Terrestrial time = UTC + ttsec                                            !FNDA132
         ttsec = (64.184D0 + 95.0D0*dt + 35.0D0*dt**2)/86400.0D0                  !FNDA133
      endif                                                                       !FNDA134
!...  Use Allison ephemeris routine to determine Ls and solar lon.                !FNDA135
!     at DATE0                                                                    !FNDA136
      call marsephm (day0 + ttsec, latsun, lonsun, yls, radius, owlt, eot)        !FNDA137
      if (iert == 1) call marsephm (day0 + ttsec - owlt/1440.0D0, latsun,     &   !FNDA138
         lonsun, yls, radius, owlt, eot)                                          !FNDA139
      day = day0                                                                  !FNDA140
      write (*, 25) latsun, lonsun, radius, owlt                                  !FNDA141
   25 format('    SunLat=',f6.2,'   SunLon=',f7.2,'   Rad=',f7.3,'   OWLT=',  &   !FNDA142
         f7.2,'    @start time')                                                  !FNDA143
      write (*, 30) time1, time2                                                  !FNDA144
   30 format('     Ls   Year Month Day  ',a3,'_',a2,'time  SiteLon',&             !FNDA145
         '  LTST    JulianDay')                                                   !FNDA146
!...  Compute solar time from site longitude and solar longitude                  !FNDA147
      ylst = 1.2D1 + (lonsun - lonsite)/1.5D1                                     !FNDA148
      if (ylst < 0.0D0) ylst = ylst + 2.4D1                                       !FNDA149
      if (ylst > 2.4D1) ylst = ylst - 2.4D1                                       !FNDA150
!...  Write out Ls and local time at starting date, time, and given               !FNDA151
!     site longitude                                                              !FNDA152
      write (*, 140) yls, myear, name, iday, ihour, minutes, sec, lonout, ew, &   !FNDA153
         ylst, day0, '@start time  '                                              !FNDA154
!...  Compute difference of Ls from desired value                                 !FNDA155
      dls = xls - yls                                                             !FNDA156
      if (dls < (-1.0D0)) dls = 3.6D2 + dls                                       !FNDA157
      if (dls > 3.59D2) dls = dls - 3.6D2                                         !FNDA158
!...  Start iteration to find date and time for desired Ls value                  !FNDA159
      do m = 1, 40                                                                !FNDA160
!...    Adjust date based on current Ls difference                                !FNDA161
         day = day + rate*dls                                                     !FNDA162
         ttsec = 0.0D0                                                            !FNDA163
         if (iutc == 1) then                                                      !FNDA164
!...      Get terrestrial dynamical time offset (seconds)                         !FNDA165
            dt = (day - 2451545.0D0)/36525.0D0                                    !FNDA166
!...      Terrestrial time = UTC + ttsec                                          !FNDA167
            ttsec = (64.184D0 + 95.0D0*dt + 35.0D0*dt**2)/86400.0D0               !FNDA168
         endif                                                                    !FNDA169
!...    Update to get new Ls and solar longitude                                  !FNDA170
         call marsephm (day + ttsec, latsun, lonsun, yls, radius, owlt, eot)      !FNDA171
         if (iert == 1) call marsephm (day + ttsec - owlt/1400.0D0, latsun,   &   !FNDA172
            lonsun, yls, radius, owlt, eot)                                       !FNDA173
!...    Update to get new Ls difference from desired value                        !FNDA174
         dls = xls - yls                                                          !FNDA175
         if (dls < (-1.8D2)) dls = 3.6D2 + dls                                    !FNDA176
         if (dls > 1.8D2) dls = dls - 3.6D2                                       !FNDA177
!...    Terminate iteration if desired accuracy is achieved                       !FNDA178
         if (dabs(rate*dls) < 1.0D-6) go to 110                                   !FNDA179
      end do                                                                      !FNDA180
      write (*, *) ' Ls calculation did not converge, m=', m                      !FNDA181
  110 continue                                                                    !FNDA182
      call jultocal (day, myear, month, iday, time)                               !FNDA183
!...  Get month name from month                                                   !FNDA184
      call namemonth (month, name)                                                !FNDA185
!...  Time of day in hours                                                        !FNDA186
      time = 2.4D1*time                                                           !FNDA187
!...  Get hour, minute, seconds from time                                         !FNDA188
      ihour = idint(time)                                                         !FNDA189
      minutes = idint(60.0D0*(time - ihour))                                      !FNDA190
      sec = (60.0D0*(time - ihour) - minutes)*60.                                 !FNDA191
!...  Compute solar time from site longitude and solar longitude                  !FNDA192
      ylst = 1.2D1 + (lonsun - lonsite)/1.5D1                                     !FNDA193
      if (ylst < 0.0D0) ylst = ylst + 2.4D1                                       !FNDA194
      if (ylst > 2.4D1) ylst = ylst - 2.4D1                                       !FNDA195
!...  Write date and time for desired Ls, and corresponding LTST                  !FNDA196
      write (*, 140) xls, myear, name, iday, ihour, minutes, sec, lonout, ew,  &  !FNDA197
         ylst, day, '@desired Ls  '                                               !FNDA198
  140 format(f9.3,i5,2x,a3,3x,i2,2x,i2,':',i2,':',f4.1,f8.2,a1,f7.3,f14.5,1x,a &  !FNDA199
         13)                                                                      !FNDA200
!...  Find nearest time when LTST = given value at site longitude                 !FNDA201
!...  Compute deviation of LTST from desired value                                !FNDA202
      dlst = xlst - ylst                                                          !FNDA203
      if (dlst > 1.2D1) dlst = dlst - 2.4D1                                       !FNDA204
      if (dlst < (-1.2D1)) dlst = dlst + 2.4D1                                    !FNDA205
!...  Store initial Julian day for LTST iteration                                 !FNDA206
      day0 = day - time/2.4D1                                                     !FNDA207
!...  Start iteration to find date and time for desired LTST                      !FNDA208
      do n = 1, 10                                                                !FNDA209
!...    Update time of day based on LTST difference from desired value            !FNDA210
         time = time + dayrate*dlst                                               !FNDA211
!...    Update Julian day                                                         !FNDA212
         day = day0 + time/2.4D1                                                  !FNDA213
         ttsec = 0.0D0                                                            !FNDA214
         if (iutc == 1) then                                                      !FNDA215
!...        Get terrestrial dynamical time offset (seconds)                       !FNDA216
            dt = (day - 2451545.0D0)/36525.0D0                                    !FNDA217
!...        Terrestrial time = UTC + ttsec                                        !FNDA218
            ttsec = (64.184D0 + 95.0D0*dt + 35.0D0*dt**2)/86400.0D0               !FNDA219
         endif                                                                    !FNDA220
!...    Compute new solar longitude and Ls                                        !FNDA221
         call marsephm (day + ttsec, latsun, lonsun, yls, radius, owlt, eot)      !FNDA222
         if (iert == 1) call marsephm (day + ttsec - owlt/1440.0D0, latsun,    &  !FNDA223
            lonsun, yls, radius, owlt, eot)                                       !FNDA224
!...    Compute Mars solar time from site longitude and solar                     !FNDA225
!       longitude                                                                 !FNDA226
         ylst = 1.2D1 + (lonsun - lonsite)/1.5D1                                  !FNDA227
         if (ylst < 0.0D0) ylst = ylst + 2.4D1                                    !FNDA228
         if (ylst > 2.4D1) ylst = ylst - 2.4D1                                    !FNDA229
!...    Update deviation from desired local true solar time                       !FNDA230
         dlst = xlst - ylst                                                       !FNDA231
         if (dlst > 1.2D1) dlst = dlst - 2.4D1                                    !FNDA232
         if (dlst < (-1.2D1)) dlst = dlst + 2.4D1                                 !FNDA233
!...    Terminate iteration if desired accuracy is achieved                       !FNDA234
         if (dabs(dlst) < 1.0D-5) go to 210                                       !FNDA235
      end do                                                                      !FNDA236
      write (*, *) ' LTST calculation did not converge, n=', n                    !FNDA237
!...  Write date and time for desired LTST, and corresponding Ls                  !FNDA238
  210 continue                                                                    !FNDA239
      call jultocal (day, myear, month, iday, time)                               !FNDA240
!...  Get month name from month                                                   !FNDA241
      call namemonth (month, name)                                                !FNDA242
!...  Time of day in hours                                                        !FNDA243
      time = 2.4D1*time                                                           !FNDA244
!...  Get hour, minute, seconds from time                                         !FNDA245
      ihour = idint(time)                                                         !FNDA246
      minutes = idint(60.0D0*(time - ihour))                                      !FNDA247
      sec = (60.0D0*(time - ihour) - minutes)*60.0D0                              !FNDA248
      write (*, 140) yls, myear, name, iday, ihour, minutes, sec, lonout, ew,  &  !FNDA249
         ylst, day, '@desired LTST'                                               !FNDA250
      write (*, *) ' Enter 0 to stop, or 1 to compute more cases'                 !FNDA251
      read (*, *) icontinue                                                       !FNDA252
      if (icontinue /= 0) go to 2                                                 !FNDA253
      stop                                                                        !FNDA254
      end program main                                                            !FNDA255
!                                                                                 !FNDA256
!---------------------------------------------------------------------            !CKDT  1
      subroutine chkdt(myear, month, iday, ihour, minutes, sec, err)              !CKDT  2
!-----------------------------------------------                                  !CKDT  3
!   M o d u l e s                                                                 !CKDT  4
!-----------------------------------------------                                  !CKDT  5
      USE vast_kind_param, ONLY:  double                                          !CKDT  6
!                                                                                 !CKDT  7
!      CHecKs input Date and Time for validity and internal                       !CKDT  8
!      consistency.  Returns error message(s) and prompts                         !CKDT  9
!      user to re-enter inputs.                                                   !CKDT 10
!                                                                                 !CKDT 11
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !CKDT 12
!...Switches:                                                                     !CKDT 13
      implicit none                                                               !CKDT 14
!-----------------------------------------------                                  !CKDT 15
!   D u m m y   A r g u m e n t s                                                 !CKDT 16
!-----------------------------------------------                                  !CKDT 17
      integer , intent(inout) :: myear                                            !CKDT 18
      integer , intent(in) :: month                                               !CKDT 19
      integer , intent(in) :: iday                                                !CKDT 20
      integer , intent(in) :: ihour                                               !CKDT 21
      integer , intent(in) :: minutes                                             !CKDT 22
      integer , intent(out) :: err                                                !CKDT 23
      real(double) , intent(in) :: sec                                            !CKDT 24
!-----------------------------------------------                                  !CKDT 25
!   L o c a l   V a r i a b l e s                                                 !CKDT 26
!-----------------------------------------------                                  !CKDT 27
      logical :: centyear, leapyear                                               !CKDT 28
!-----------------------------------------------                                  !CKDT 29
      err = 0                                                                     !CKDT 30
      centyear = .FALSE.                                                          !CKDT 31
      leapyear = .FALSE.                                                          !CKDT 32
!...   Convert to 4-digit year, if necessary                                      !CKDT 33
      if (myear>=0 .and. myear<=69) myear = myear + 2000                          !CKDT 34
      if (myear>=70 .and. myear<=99) myear = myear + 1900                         !CKDT 35
      if (myear<1970 .or. myear>2069) then                                        !CKDT 36
         write (*, *) ' Year must be 1970-2069'                                   !CKDT 37
         err = -1                                                                 !CKDT 38
      endif                                                                       !CKDT 39
      if (mod(myear,100) == 0) centyear = .TRUE.                                  !CKDT 40
      if (mod(myear,4) == 0) leapyear = .TRUE.                                    !CKDT 41
      if (centyear) then                                                          !CKDT 42
         if (mod(myear,400) /= 0) leapyear = .FALSE.                              !CKDT 43
      endif                                                                       !CKDT 44
      if (month<1 .or. month>12) then                                             !CKDT 45
         write (*, *) ' Month must be 1-12'                                       !CKDT 46
         err = -2                                                                 !CKDT 47
      endif                                                                       !CKDT 48
      if (month==4 .or. month==6 .or. month==9 .or. month==11) then               !CKDT 49
         if (iday<1 .or. iday>30) then                                            !CKDT 50
            write (*, *) ' Day of month must be 1-30'                             !CKDT 51
            err = -3                                                              !CKDT 52
         endif                                                                    !CKDT 53
      else if (month == 2) then                                                   !CKDT 54
         if (leapyear) then                                                       !CKDT 55
            if (iday<1 .or. iday>29) then                                         !CKDT 56
               write (*, *) ' Day of month must be 1-29 (Leap Year)'              !CKDT 57
               err = -4                                                           !CKDT 58
            endif                                                                 !CKDT 59
         else if (iday<1 .or. iday>28) then                                       !CKDT 60
            write (*, *) ' Day of month must be 1-28 (Non-Leap Year)'             !CKDT 61
            err = -5                                                              !CKDT 62
         endif                                                                    !CKDT 63
      else if (iday<1 .or. iday>31) then                                          !CKDT 64
         write (*, *) ' Day of month must be 1-31'                                !CKDT 65
         err = -6                                                                 !CKDT 66
      endif                                                                       !CKDT 67
      if (ihour<0 .or. ihour>24) then                                             !CKDT 68
         write (*, *) ' Hour must be 0-24'                                        !CKDT 69
         err = -7                                                                 !CKDT 70
      endif                                                                       !CKDT 71
      if (ihour==24 .and. (minutes/=0 .or. sec/=0.0D0)) then                      !CKDT 72
         write (*, *) ' Hour must be 23 or Time must be 24:00:00'                 !CKDT 73
         err = -7                                                                 !CKDT 74
      endif                                                                       !CKDT 75
      if (minutes<0 .or. minutes>60) then                                         !CKDT 76
         write (*, *) ' Minutes must be 0-60'                                     !CKDT 77
         err = -8                                                                 !CKDT 78
      endif                                                                       !CKDT 79
      if (minutes==60 .and. sec/=0.0D0) then                                      !CKDT 80
         write (*, *) ' Minutes must be 59 or Seconds must be 0'                  !CKDT 81
         err = -8                                                                 !CKDT 82
      endif                                                                       !CKDT 83
      if (sec<0.0D0 .or. sec>60.0D0) then                                         !CKDT 84
         write (*, *) ' Seconds must be 0.0-60.0'                                 !CKDT 85
         err = -9                                                                 !CKDT 86
      endif                                                                       !CKDT 87
      return                                                                      !CKDT 88
      end subroutine chkdt                                                        !CKDT 89
!                                                                                 !CKDT 90
!----------------------------------------------------------------------           !CTOJ  1
      SUBROUTINE CALTOJUL(IY, IM, ID, IHOUR, IMIN, SEC, XJD)                      !CTOJ  2
!-----------------------------------------------                                  !CTOJ  3
!   M o d u l e s                                                                 !CTOJ  4
!-----------------------------------------------                                  !CTOJ  5
      USE vast_kind_param, ONLY:  DOUBLE                                          !CTOJ  6
!                                                                                 !CTOJ  7
!     Compute Julian day (Real*8) by method of Meeus, Astronomical                !CTOJ  8
!       Algorithms, 2nd Edition, 1998, page 61. Inputs are year iY,               !CTOJ  9
!       month iM, day of month iD, and time of day in hours, minutes,             !CTOJ 10
!       and seconds (all integer except seconds).  Output is Real*8               !CTOJ 11
!       Julian day, xJD.                                                          !CTOJ 12
!                                                                                 !CTOJ 13
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !CTOJ 14
!...Switches:                                                                     !CTOJ 15
      IMPLICIT NONE                                                               !CTOJ 16
!-----------------------------------------------                                  !CTOJ 17
!   D u m m y   A r g u m e n t s                                                 !CTOJ 18
!-----------------------------------------------                                  !CTOJ 19
      INTEGER , INTENT(IN) :: IY                                                  !CTOJ 20
      INTEGER , INTENT(IN) :: IM                                                  !CTOJ 21
      INTEGER , INTENT(IN) :: ID                                                  !CTOJ 22
      INTEGER , INTENT(IN) :: IHOUR                                               !CTOJ 23
      INTEGER , INTENT(IN) :: IMIN                                                !CTOJ 24
      REAL(DOUBLE) , INTENT(IN) :: SEC                                            !CTOJ 25
      REAL(DOUBLE) , INTENT(OUT) :: XJD                                           !CTOJ 26
!-----------------------------------------------                                  !CTOJ 27
!   L o c a l   V a r i a b l e s                                                 !CTOJ 28
!-----------------------------------------------                                  !CTOJ 29
      INTEGER :: Y, M, A, B                                                       !CTOJ 30
      REAL(DOUBLE) :: D                                                           !CTOJ 31
!-----------------------------------------------                                  !CTOJ 32
      Y = IY                                                                      !CTOJ 33
      M = IM                                                                      !CTOJ 34
!...  Consider Jan or Feb as if months 13 and 14 of previous year                 !CTOJ 35
      IF (IM <= 2) THEN                                                           !CTOJ 36
         Y = IY - 1                                                               !CTOJ 37
         M = IM + 12                                                              !CTOJ 38
      ENDIF                                                                       !CTOJ 39
!...  Compute day of month plus fractional part                                   !CTOJ 40
      D = ID + IHOUR/2.4D1 + IMIN/1.440D3 + SEC/8.64D4                            !CTOJ 41
      A = IDINT(Y/100.0D0)                                                        !CTOJ 42
      B = 2 - A + IDINT(A/4.0D0)                                                  !CTOJ 43
!...  Compute Julian day with fractional part                                     !CTOJ 44
      XJD = IDINT(365.25D0*(Y + 4716)) + IDINT(30.6001D0*(M + 1)) + D + B -   &   !CTOJ 45
         1524.5D0                                                                 !CTOJ 46
      RETURN                                                                      !CTOJ 47
      END SUBROUTINE CALTOJUL                                                     !CTOJ 48
!                                                                                 !CTOJ 49
!----------------------------------------------------------------------           !JCAL  1
      SUBROUTINE JULTOCAL(JD, YEAR, MONTH, DAY, DAYFRAC)                          !JCAL  2
!-----------------------------------------------                                  !JCAL  3
!   M o d u l e s                                                                 !JCAL  4
!-----------------------------------------------                                  !JCAL  5
      USE vast_kind_param, ONLY:  DOUBLE                                          !JCAL  6
!...    Compute year, month, day of month, and fraction of day                    !JCAL  7
!       from Julian day JD.  Algorithm from Meeus, Astronomical                   !JCAL  8
!       Algorithms, 2nd edition, 1998, page 63                                    !JCAL  9
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !JCAL 10
!...Switches:                                                                     !JCAL 11
      IMPLICIT NONE                                                               !JCAL 12
!-----------------------------------------------                                  !JCAL 13
!   D u m m y   A r g u m e n t s                                                 !JCAL 14
!-----------------------------------------------                                  !JCAL 15
      INTEGER , INTENT(OUT) :: YEAR                                               !JCAL 16
      INTEGER , INTENT(INOUT) :: MONTH                                            !JCAL 17
      INTEGER , INTENT(OUT) :: DAY                                                !JCAL 18
      REAL(DOUBLE) , INTENT(IN) :: JD                                             !JCAL 19
      REAL(DOUBLE) , INTENT(OUT) :: DAYFRAC                                       !JCAL 20
!-----------------------------------------------                                  !JCAL 21
!   L o c a l   V a r i a b l e s                                                 !JCAL 22
!-----------------------------------------------                                  !JCAL 23
      INTEGER :: Z, A, ALPHA, B, C, D, E                                          !JCAL 24
      REAL(DOUBLE) :: F, JDP                                                      !JCAL 25
!-----------------------------------------------                                  !JCAL 26
!...    Add 0.5 to Julian day                                                     !JCAL 27
      JDP = JD + 0.5D0                                                            !JCAL 28
!...    Get integer part and fractional part of JD+0.5                            !JCAL 29
      Z = IDINT(JDP)                                                              !JCAL 30
      F = JDP - Z                                                                 !JCAL 31
!...    Compute parameter A                                                       !JCAL 32
      IF (Z < 2299161) THEN                                                       !JCAL 33
         A = Z                                                                    !JCAL 34
      ELSE                                                                        !JCAL 35
         ALPHA = IDINT((Z - 1867216.25D0)/36524.25D0)                             !JCAL 36
         A = Z + 1 + ALPHA - IDINT(ALPHA/4.0D0)                                   !JCAL 37
      ENDIF                                                                       !JCAL 38
!...    Compute parameters B, C, D, and E                                         !JCAL 39
      B = A + 1524                                                                !JCAL 40
      C = IDINT((B - 122.1D0)/365.25D0)                                           !JCAL 41
      D = IDINT(365.25D0*C)                                                       !JCAL 42
      E = IDINT((B - D)/30.6001D0)                                                !JCAL 43
!...    Get integer day of month and fractional day from parameters               !JCAL 44
!         B, D, E, and F                                                          !JCAL 45
      DAYFRAC = B - D - IDINT(30.6001D0*E) + F                                    !JCAL 46
      DAY = IDINT(DAYFRAC)                                                        !JCAL 47
      DAYFRAC = DAYFRAC - DAY                                                     !JCAL 48
!...    Get month from parameter E                                                !JCAL 49
      IF (E < 2) THEN                                                             !JCAL 50
         STOP ' Bad month parameter E: too small'                                 !JCAL 51
      ELSE IF (E < 14) THEN                                                       !JCAL 52
         MONTH = E - 1                                                            !JCAL 53
      ELSE IF (E < 16) THEN                                                       !JCAL 54
         MONTH = E - 13                                                           !JCAL 55
      ELSE                                                                        !JCAL 56
         STOP ' Bad month parameter E: too large'                                 !JCAL 57
      ENDIF                                                                       !JCAL 58
!...    Get year from parameter C                                                 !JCAL 59
      IF (MONTH > 2) THEN                                                         !JCAL 60
         YEAR = C - 4716                                                          !JCAL 61
      ELSE                                                                        !JCAL 62
         YEAR = C - 4715                                                          !JCAL 63
      ENDIF                                                                       !JCAL 64
      RETURN                                                                      !JCAL 65
      END SUBROUTINE JULTOCAL                                                     !JCAL 66
!                                                                                 !JCAL 67
!----------------------------------------------------------------------           !NMMN  1
      subroutine namemonth(month, monthname)                                      !NMMN  2
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !NMMN  3
!...Switches:                                                                     !NMMN  4
      implicit none                                                               !NMMN  5
!-----------------------------------------------                                  !NMMN  6
!   D u m m y   A r g u m e n t s                                                 !NMMN  7
!-----------------------------------------------                                  !NMMN  8
      integer , intent(in) :: month                                               !NMMN  9
      character , intent(out) :: monthname*3                                      !NMMN 10
!-----------------------------------------------                                  !NMMN 11
!   L o c a l   V a r i a b l e s                                                 !NMMN 12
!-----------------------------------------------                                  !NMMN 13
      character, dimension(12) :: months*3                                        !NMMN 14
!-----------------------------------------------                                  !NMMN 15
!                                                                                 !NMMN 16
!      Computes month name from given month number                                !NMMN 17
!                                                                                 !NMMN 18
      data months/ 'JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG',    &   !NMMN 19
         'SEP', 'OCT', 'NOV', 'DEC'/                                              !NMMN 20
      monthname = months(month)                                                   !NMMN 21
      return                                                                      !NMMN 22
      end subroutine namemonth                                                    !NMMN 23
!                                                                                 !NMMN 24
!----------------------------------------------------------------------           !RSCL  1
      subroutine rescale(x)                                                       !RSCL  2
!-----------------------------------------------                                  !RSCL  3
!   M o d u l e s                                                                 !RSCL  4
!-----------------------------------------------                                  !RSCL  5
      USE vast_kind_param, ONLY:  double                                          !RSCL  6
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !RSCL  7
!...Switches:                                                                     !RSCL  8
      implicit none                                                               !RSCL  9
!-----------------------------------------------                                  !RSCL 10
!   D u m m y   A r g u m e n t s                                                 !RSCL 11
!-----------------------------------------------                                  !RSCL 12
      real(double) , intent(inout) :: x                                           !RSCL 13
!-----------------------------------------------                                  !RSCL 14
!   L o c a l   V a r i a b l e s                                                 !RSCL 15
!-----------------------------------------------                                  !RSCL 16
!-----------------------------------------------                                  !RSCL 17
!...  Puts x into range 0 - 360                                                   !RSCL 18
      x = x/360.0D0 - dint(x/360.0D0) + 1.0D0                                     !RSCL 19
      x = (x - dint(x))*360.0D0                                                   !RSCL 20
      return                                                                      !RSCL 21
      end subroutine rescale                                                      !RSCL 22
!                                                                                 !RSCL 23
!----------------------------------------------------------------------           !SHFD  1
      subroutine shiftdif(x)                                                      !SHFD  2
!-----------------------------------------------                                  !SHFD  3
!   M o d u l e s                                                                 !SHFD  4
!-----------------------------------------------                                  !SHFD  5
      USE vast_kind_param, ONLY:  double                                          !SHFD  6
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !SHFD  7
!...Switches:                                                                     !SHFD  8
      implicit none                                                               !SHFD  9
!-----------------------------------------------                                  !SHFD 10
!   D u m m y   A r g u m e n t s                                                 !SHFD 11
!-----------------------------------------------                                  !SHFD 12
      real(double) , intent(inout) :: x                                           !SHFD 13
!-----------------------------------------------                                  !SHFD 14
!   L o c a l   V a r i a b l e s                                                 !SHFD 15
!-----------------------------------------------                                  !SHFD 16
!-----------------------------------------------                                  !SHFD 17
!...  Shifts difference x to be +/- and close to 0.0                              !SHFD 18
      if (x > 180.0D0) then                                                       !SHFD 19
         x = x - 360.0D0                                                          !SHFD 20
      else if (x < (-180.0D0)) then                                               !SHFD 21
         x = x + 360.0D0                                                          !SHFD 22
      endif                                                                       !SHFD 23
      return                                                                      !SHFD 24
      end subroutine shiftdif                                                     !SHFD 25
!                                                                                 !SHFD 26
!----------------------------------------------------------------------           !MEPH  1
      subroutine marsephm(xday, sunlat, sunlon, sunlsubs, radius, owlt, eot)      !MEPH  2
!-----------------------------------------------                                  !MEPH  3
!   M o d u l e s                                                                 !MEPH  4
!-----------------------------------------------                                  !MEPH  5
      USE vast_kind_param, ONLY:  double                                          !MEPH  6
!...  Computes sunlat, sunlon= latitude and longitude of sub-solar                !MEPH  7
!     point on the surface, sunLsubs= areocentric longitude of the Sun            !MEPH  8
!     (Ls), radius= current orbital radius from Sun to Mars, heliolon=            !MEPH  9
!     Mars heliocentric longitude, owlt= Mars-Earth one-way light                 !MEPH 10
!     time (minutes), and EOT= equation of time (deg), calculated from            !MEPH 11
!     Julian day and time, xday.  Notes: input xday is NOT UTC, but               !MEPH 12
!     Terrestrial (Dynamical) Mars-Event Time (NOT Earth-Receive Time).           !MEPH 13
!     Mars Local Mean Solar Time (hrs ) = Local True Solar Time (hrs)             !MEPH 14
!     minus EOT (in hrs). Output is for Terrestrial (Dynamical)                   !MEPH 15
!     Mars Event Time (corresponding to input xday).                              !MEPH 16
!                                                                                 !MEPH 17
!     Equations for "moderately accurate" Mars solar time, seasonal               !MEPH 18
!     parameters, and one-way Mars-Earth light time, from Allison and             !MEPH 19
!     McEwen, Planet. Space Sci., 48, 215-235 (2000), and Allison                 !MEPH 20
!     Geophys Res. Lett., 24(16), 1967-1970 (1997).                               !MEPH 21
!                                                                                 !MEPH 22
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !MEPH 23
!...Switches:                                                                     !MEPH 24
!-----------------------------------------------                                  !MEPH 25
!   I n t e r f a c e   B l o c k s                                               !MEPH 26
!-----------------------------------------------                                  !MEPH 27
      use perturb_I                                                               !MEPH 28
      use rescale_I                                                               !MEPH 29
      use shiftdif_I                                                              !MEPH 30
      implicit none                                                               !MEPH 31
!-----------------------------------------------                                  !MEPH 32
!   D u m m y   A r g u m e n t s                                                 !MEPH 33
!-----------------------------------------------                                  !MEPH 34
      real(double) , intent(in) :: xday                                           !MEPH 35
      real(double) , intent(out) :: sunlat                                        !MEPH 36
      real(double)  :: sunlon                                                     !MEPH 37
      real(double)  :: sunlsubs                                                   !MEPH 38
      real(double) , intent(out) :: radius                                        !MEPH 39
      real(double) , intent(out) :: owlt                                          !MEPH 40
      real(double)  :: eot                                                        !MEPH 41
!-----------------------------------------------                                  !MEPH 42
!   L o c a l   V a r i a b l e s                                                 !MEPH 43
!-----------------------------------------------                                  !MEPH 44
      real(double) :: pi180, dt, anomm, alphfms, alsrad, helilon, alphs, pmr,  &  !MEPH 45
         ge, re, dlat1, helone, vm, yranom, anom0, yrtrop, veqlon0, perlon0,   &  !MEPH 46
         ecc, obl, dlat2, dlat3, veqlon1, inc, anlon0, siday, rad0, ecc2, ecc3 &  !MEPH 47
         , ecc4, ecc5, ecc6, vm0, vmday0, pbs, xe, ye, xpl, ypl, zpl, eqcenter &  !MEPH 48
         , argper, trueanom, coslat                                               !MEPH 49
!-----------------------------------------------                                  !MEPH 50
      pi180 = datan(1.0D0)/45.0D0                                                 !MEPH 51
!...  Days since 2000 January 1.5                                                 !MEPH 52
      dt = xday - 2451545.0D0                                                     !MEPH 53
!                                                                                 !MEPH 54
!.....................................................................            !MEPH 55
!                                                                                 !MEPH 56
!...  Planetary orbit parameters                                                  !MEPH 57
!                                                                                 !MEPH 58
!     Semi-major axis (AU) = mean distance from Sun                               !MEPH 59
      rad0 = 1.52368D0                                                            !MEPH 60
!     Anomalistic year (days, perihelion-to-perihelion)                           !MEPH 61
      yranom = 686.9957D0                                                         !MEPH 62
!     Tropical year (days, for rate of fictitious mean sun)                       !MEPH 63
      yrtrop = 686.9726D0                                                         !MEPH 64
!     Mean anomaly for J2000 (degrees)                                            !MEPH 65
      anom0 = 19.387D0                                                            !MEPH 66
!     Heliocentric longitude of perihelion at J2000 (deg)                         !MEPH 67
      perlon0 = 336.0602D0                                                        !MEPH 68
!     Terms for heliocentric longitude at Ls=0 (deg)                              !MEPH 69
      veqlon0 = 85.061D0                                                          !MEPH 70
      veqlon1 = 5.5D-6                                                            !MEPH 71
!     Eccentricity and powers                                                     !MEPH 72
      ecc = 0.09340D0 + 2.477D-9*dt                                               !MEPH 73
      ecc2 = ecc**2                                                               !MEPH 74
      ecc3 = ecc2*ecc                                                             !MEPH 75
      ecc4 = ecc3*ecc                                                             !MEPH 76
      ecc5 = ecc4*ecc                                                             !MEPH 77
      ecc6 = ecc5*ecc                                                             !MEPH 78
!     Obliquity angle (radians)                                                   !MEPH 79
      obl = (25.1919D0 + 3.45D-7*dt)*pi180                                        !MEPH 80
!     Inclination (radians)                                                       !MEPH 81
      inc = (1.8497D0 - 2.23D-7*dt)*pi180                                         !MEPH 82
!     Longitude of ascending node at J2000 (deg)                                  !MEPH 83
      anlon0 = 49.5581D0                                                          !MEPH 84
!     Sidereal period of rotation (Earth days)                                    !MEPH 85
!...  Empirical correction in last digit, to agree with Horizons                  !MEPH 86
      siday = 1.025956747D0                                                       !MEPH 87
!     Heliocentric lon of prime meridian (deg) at Julian day Vmday0               !MEPH 88
      vm0 = 133.476D0                                                             !MEPH 89
!...  Empirical correction for agreement with Horizons data                       !MEPH 90
      vm0 = vm0 - 0.09746D0                                                       !MEPH 91
      vmday0 = 2451545.0D0                                                        !MEPH 92
!     Difference terms, planetocentric to planetographic lat (deg)                !MEPH 93
      dlat1 = 0.269D0                                                             !MEPH 94
      dlat2 = 0.003D0                                                             !MEPH 95
      dlat3 = 0.008D0                                                             !MEPH 96
!                                                                                 !MEPH 97
!.....................................................................            !MEPH 98
!                                                                                 !MEPH 99
!...  Mean anomaly (radians)                                                      !MEPH100
!...  Allison & McEwen (2000) equation (16)                                       !MEPH101
      anomm = (anom0 + (360.0D0/yranom)*dt)*pi180                                 !MEPH102
!...  Right ascension of fictitious mean sun (deg)                                !MEPH103
!...  Allison & McEwen (2000) equation (17)                                       !MEPH104
      alphfms = perlon0 - veqlon0 + anom0 + (360.0D0/yrtrop)*dt                   !MEPH105
!...  Mars equation of center, A&M eqn. (4) (degrees)                             !MEPH106
      eqcenter = ((2.0D0*ecc - 0.25D0*ecc3 + (5.0D0/96.0D0)*ecc5)*dsin(anomm)  &  !MEPH107
          + (1.25D0*ecc2 - (11.0D0/24.0D0)*ecc4 + (17.0D0/192.0D0)*ecc6)*dsin( &  !MEPH108
         2.0D0*anomm) + ((13.0D0/12.0D0)*ecc3 - (43.0D0/63.0D0)*ecc5)*dsin(    &  !MEPH109
         3.0D0*anomm) + ((103.0D0/96.0D0)*ecc4 - (451.0D0/480.0D0)*ecc6)*dsin( &  !MEPH110
         4.0D0*anomm) + ((1097.0D0/960.0D0)*ecc5)*dsin(5.0D0*anomm) + ((       &  !MEPH111
         12323.0D0/960.0D0)*ecc6)*dsin(6.0D0*anomm))/pi180                        !MEPH112
!...  True areocentric solar longitude (Ls), A&M eqns. (2) and (4)                !MEPH113
      sunlsubs = alphfms + eqcenter                                               !MEPH114
!...  Add perturbations due to Jupiter, Earth, and Venus, A&M eqns.               !MEPH115
!     (18) and (19)                                                               !MEPH116
      call perturb (dt, pbs)                                                      !MEPH117
      sunlsubs = sunlsubs + pbs                                                   !MEPH118
      call rescale (sunlsubs)                                                     !MEPH119
!...  Ls angle in radians                                                         !MEPH120
      alsrad = sunlsubs*pi180                                                     !MEPH121
!...  Sub-solar latitude of sun (planetographic solar declination),               !MEPH122
!     Allison (1997) eqn. (5) with empirical Ls and 3*Ls terms                    !MEPH123
      sunlat = dasin(sin(obl)*dsin(alsrad))/pi180 + dlat1*dsin(alsrad) + dlat2* & !MEPH124
         dcos(alsrad) + dlat3*dsin(3.0D0*alsrad)                                  !MEPH125
!...  Solar right ascension, un-numbered equation, A&M page 217                   !MEPH126
      alphs = datan(dcos(obl)*dtan(alsrad))/pi180                                 !MEPH127
!...  Put alphs into right quadrant                                               !MEPH128
      if (dabs(sunlsubs - alphs) > 270.0D0) then                                  !MEPH129
         alphs = alphs + 360.0D0                                                  !MEPH130
      else if (dabs(sunlsubs - alphs) > 90.0D0) then                              !MEPH131
         alphs = alphs + 180.0D0                                                  !MEPH132
      endif                                                                       !MEPH133
      call rescale (alphs)                                                        !MEPH134
!...  Mars orbital radius, Astronomical Almanac page E4                           !MEPH135
      radius = rad0*(1.0D0 - ecc2)/(1.0D0 + ecc*dcos(anomm + alsrad - alphfms*  & !MEPH136
         pi180))                                                                  !MEPH137
!...  Approximate Mars heliocentric longitude, A&M eqn, (11)                      !MEPH138
      helilon = sunlsubs + veqlon0 - veqlon1*dt - dtan(0.5D0*inc)**2*dsin(2.0D0 & !MEPH139
         *(alsrad + (veqlon0 - anlon0)*pi180))/pi180                              !MEPH140
      call rescale (helilon)                                                      !MEPH141
!...  Equation of time (deg)                                                      !MEPH142
      eot = alphfms - alphs                                                       !MEPH143
      call rescale (eot)                                                          !MEPH144
      call shiftdif (eot)                                                         !MEPH145
!...  Earth heliocentric distance and longitude, Allison eqns (20)-               !MEPH146
!     (22)                                                                        !MEPH147
      ge = (357.528D0 + 0.9856003D0*dt)*pi180                                     !MEPH148
      re = 1.00014D0 - 0.01671D0*dcos(ge) - 0.00014D0*dcos(2.0D0*ge)              !MEPH149
      helone = 100.472D0 + 0.9856474D0*dt + 1.915D0*dsin(ge) + 0.020D0*dsin(    & !MEPH150
         2.0D0*ge)                                                                !MEPH151
!...  Earth Cartesian coordinates                                                 !MEPH152
      xe = re*dcos(helone*pi180)                                                  !MEPH153
      ye = re*dsin(helone*pi180)                                                  !MEPH154
!...  Mars true anolmaly (radians)                                                !MEPH155
      trueanom = eqcenter*pi180 + anomm                                           !MEPH156
!...  Mars argument of perihelion (radians)                                       !MEPH157
      argper = (286.5016D0 + 2.92961D-5*dt)*pi180                                 !MEPH158
!...  Mars Cartesian coordinates                                                  !MEPH159
      zpl = radius*dsin(trueanom + argper)*dsin(inc)                              !MEPH160
      coslat = dsqrt(1.0D0 - (zpl/radius)**2)                                     !MEPH161
      xpl = radius*dcos((helilon + 3.82394D-5*dt)*pi180)*coslat                   !MEPH162
      ypl = radius*dsin((helilon + 3.82394D-5*dt)*pi180)*coslat                   !MEPH163
!...  One-way light time (minutes), Allison eqn.(19)                              !MEPH164
      owlt = dsqrt((xpl - xe)**2 + (ypl - ye)**2 + zpl**2)*499.005D0/60.0D0       !MEPH165
!...  Mars (Heliocentric) prime meridian, Allison eqn (11)                        !MEPH166
      vm = vm0 + (360.0D0/siday)*(xday - vmday0)                                  !MEPH167
!...  True solar time (Mars hours) at Mars prime meridian, A&M                    !MEPH168
!     page 217                                                                    !MEPH169
      pmr = (vm - alphs)/360.0D0                                                  !MEPH170
      sunlon = (pmr - dint(pmr))*360.0D0 - 180.0D0                                !MEPH171
      call rescale (sunlon)                                                       !MEPH172
      return                                                                      !MEPH173
      end subroutine marsephm                                                     !MEPH174
!                                                                                 !MEPH175
!---------------------------------------------------------------------            !PTRD  1
      subroutine perturb(dt, pbs)                                                 !PTRD  2
!-----------------------------------------------                                  !PTRD  3
!   M o d u l e s                                                                 !PTRD  4
!-----------------------------------------------                                  !PTRD  5
      USE vast_kind_param, ONLY:  double                                          !PTRD  6
!...  Mars Ls perturbations from Jupiter, Earth, and Venus, Table 5               !PTRD  7
!     and eqn (18) of Allison and McEwen, Planet. Space Sci., 48, 215-            !PTRD  8
!     235 (2000). dt is time (days) after J2000 Terrestrial Time.                 !PTRD  9
!...Translated by Pacific-Sierra Research 77to90  4.4G  11:22:09  03/26/10        !PTRD 10
!...Switches:                                                                     !PTRD 11
      implicit none                                                               !PTRD 12
!-----------------------------------------------                                  !PTRD 13
!   D u m m y   A r g u m e n t s                                                 !PTRD 14
!-----------------------------------------------                                  !PTRD 15
      real(double) , intent(in) :: dt                                             !PTRD 16
      real(double) , intent(out) :: pbs                                           !PTRD 17
!-----------------------------------------------                                  !PTRD 18
!   L o c a l   V a r i a b l e s                                                 !PTRD 19
!-----------------------------------------------                                  !PTRD 20
      integer :: i                                                                !PTRD 21
      real(double), dimension(7) :: a, tau, phi                                   !PTRD 22
      real(double) :: pi180, per                                                  !PTRD 23
!-----------------------------------------------                                  !PTRD 24
!     Table 5 Data: amplitudes (deg), periods (J yrs), phases (deg)               !PTRD 25
      data a/ 0.007D0, 0.006D0, 0.004D0, 0.004D0, 0.002D0, 0.002D0, 0.002D0/      !PTRD 26
      data tau/ 2.2353D0, 2.7543D0, 1.1177D0, 15.7866D0, 2.1354D0, 2.4694D0,  &   !PTRD 27
         32.8493D0/                                                               !PTRD 28
      data phi/ 49.909D0, 168.173D0, 191.837D0, 21.736D0, 15.704D0, 95.528D0, &   !PTRD 29
         49.095D0/                                                                !PTRD 30
      pi180 = atan(1.0D0)/45.0D0                                                  !PTRD 31
      per = (360.0D0/365.25D0)*pi180                                              !PTRD 32
      pbs = 0.0D0                                                                 !PTRD 33
      do i = 1, 7                                                                 !PTRD 34
         pbs = pbs + a(i)*dcos(per*dt/tau(i)+phi(i)*pi180)                        !PTRD 35
      end do                                                                      !PTRD 36
      return                                                                      !PTRD 37
      end subroutine perturb                                                      !PTRD 38
